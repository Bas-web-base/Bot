<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exness Auto-Trading Bot</title>
    
    <!-- PWA Meta and Theme Color (Exness Dark) -->
    <meta name="theme-color" content="#0D1321">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Manifest link will be injected by the PWA script -->
    <link rel="icon" href="https://placehold.co/192x192/0D1321/00A389?text=E" type="image/png">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // Configure Tailwind CSS for dark mode and Exness colors
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'exness-bg-primary': '#0D1321', // Main Dark Background
                        'exness-bg-secondary': '#12213A', // Card/Section Background
                        'exness-accent': '#00A389', // Primary Green Accent
                        'exness-text': '#E5E7EB', // Light Text
                        'exness-border': '#1E3557', // Border color
                        'exness-up': '#16C784', // Green for gains
                        'exness-down': '#EA3943', // Red for losses
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans', 'sans-serif'],
                    }
                },
            },
        }
    </script>
    
    <style>
        /* Base Styling for Exness Dark Mode */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D1321;
            color: #E5E7EB;
            min-height: 100vh;
            margin: 0;
        }
        .header-btn {
            @apply px-4 py-2 rounded-xl text-sm font-semibold transition-colors duration-200;
        }
        .cta-button {
            @apply flex-1 text-center py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-[1.02];
        }
        /* Custom scrollbar for charts/tables */
        .scroll-container::-webkit-scrollbar {
            height: 6px;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background: #1E3557;
            border-radius: 10px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: #12213A;
        }
        /* Loading Overlay Style */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 19, 33, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease;
        }
        #loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 4px solid rgba(0, 163, 137, 0.2);
            border-top: 4px solid #00A389;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- React and ReactDOM CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-exness-bg-primary">
    <div id="root"></div>

    <!-- PWA Installation Script Integration (Adapted from provided files) -->
    <script>
        (function initPWAInstaller() {
            'use strict'; 

            /* =========================
               Configuration (UPDATED FOR EXNESS BOT)
               ========================= */
            const CACHE_NAME = 'exness-bot-pwa-v1';
            // PWA must cache both index.html and AI-Trading-Bot.html
            const PRECACHE_URLS = ['/', '/index.html', '/AI-Trading-Bot.html']; 
            const APP_NAME = 'Exness Auto-Trading Bot';
            const APP_SHORT_NAME = 'Exness Bot';
            const THEME_COLOR = '#0D1321';
            const BACKGROUND_COLOR = '#0D1321'; 
            // Placeholder for Exness Logo PNG (since no image was provided)
            const ICON_PNG_URL = 'https://placehold.co/512x512/0D1321/00A389?text=E'; 

            /* =========================
               State & Helpers
               ========================= */
            let deferredPrompt = null;
            let isAppInstalled = false;
            let manifestBlobUrl = null;
            let swRegistration = null; 

            function $ (id) { return document.getElementById(id); }
            function createEl (tag, props = {}, children = []) {
                const el = document.createElement(tag);
                Object.keys(props).forEach(k => {
                    if (k === 'style') Object.assign(el.style, props[k]);
                    else if (k === 'attrs') Object.keys(props.attrs).forEach(a => el.setAttribute(a, props.attrs[a]));
                    else el[k] = props[k];
                });
                (Array.isArray(children) ? children : [children]).forEach(c => {
                    if (typeof c === 'string') el.appendChild(document.createTextNode(c));
                    else if (c) el.appendChild(c);
                });
                return el;
            } 

            /* =========================
               Manifest and SW Management
               ========================= */
            function ensureManifest() {
                try {
                    const existing = document.querySelector('link[rel="manifest"]');
                    if (existing) existing.parentNode.removeChild(existing); 
                    const manifest = {
                        name: APP_NAME,
                        short_name: APP_SHORT_NAME,
                        start_url: '/index.html',
                        scope: '/',
                        display: 'standalone',
                        orientation: 'portrait',
                        theme_color: THEME_COLOR,
                        background_color: BACKGROUND_COLOR,
                        icons: [
                            { src: ICON_PNG_URL, sizes: '192x192', type: 'image/png', purpose: 'any' },
                            { src: ICON_PNG_URL, sizes: '512x512', type: 'image/png', purpose: 'maskable any' }
                        ],
                        description: 'Exness Auto-Trading Bot - Automated execution for your crypto portfolio.'
                    }; 
                    const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                    manifestBlobUrl = URL.createObjectURL(blob);
                    const link = createEl('link', { attrs: { rel: 'manifest', href: manifestBlobUrl }});
                    document.head.appendChild(link);
                    console.info('PWA manifest injected/updated.');
                } catch (err) {
                    console.error('Failed to create manifest:', err);
                }
            } 

            async function registerServiceWorker() {
                if (!('serviceWorker' in navigator)) {
                    console.warn('Service Worker not supported.');
                    return null;
                } 
                
                const swCode = `
                    const CACHE_NAME = '${CACHE_NAME}';
                    const PRECACHE = ${JSON.stringify(PRECACHE_URLS)}; 
                    
                    self.addEventListener('install', (evt) => {
                        evt.waitUntil((async () => {
                            try {
                                const c = await caches.open(CACHE_NAME);
                                await c.addAll(PRECACHE);
                            } catch (e) {
                                console.log('Precache failed:', e);
                            }
                            self.skipWaiting();
                        })());
                    }); 
                    
                    self.addEventListener('activate', (evt) => {
                        evt.waitUntil((async () => {
                            const keys = await caches.keys();
                            await Promise.all(keys.map(k => k === CACHE_NAME ? Promise.resolve() : caches.delete(k)));
                            await self.clients.claim();
                        })());
                    }); 
                    
                    self.addEventListener('fetch', (evt) => {
                        evt.respondWith((async () => {
                            try {
                                const cache = await caches.open(CACHE_NAME);
                                const cached = await cache.match(evt.request);
                                if (cached) return cached;
                                const response = await fetch(evt.request);
                                if (evt.request.method === 'GET' && response && response.status === 200 && evt.request.url.startsWith(self.location.origin)) {
                                    cache.put(evt.request, response.clone()).catch(()=>{});
                                }
                                return response;
                            } catch (err) {
                                // Fallback to index.html for navigation requests
                                if (evt.request.mode === 'navigate') {
                                    const cache = await caches.open(CACHE_NAME);
                                    const fallback = await cache.match('/index.html') || cache.match(PRECACHE[0]);
                                    if (fallback) return fallback;
                                }
                                return new Response('Offline', { status: 503, statusText: 'Offline' });
                            }
                        })());
                    }); 

                    self.addEventListener('message', async (evt) => {
                        const data = evt.data || {};
                        if (data && data.type === 'CACHE_URLS' && Array.isArray(data.urls)) {
                            try {
                                const cache = await caches.open(CACHE_NAME);
                                await cache.addAll(data.urls);
                                const cs = await self.clients.matchAll();
                                cs.forEach(c => c.postMessage({ type: 'cached', urls: data.urls }));
                            } catch (e) {
                                const cs = await self.clients.matchAll();
                                cs.forEach(c => c.postMessage({ type: 'cache_failed', error: String(e) }));
                            }
                        }
                    });
                `; 
                try {
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const blobUrl = URL.createObjectURL(blob);
                    const reg = await navigator.serviceWorker.register(blobUrl);
                    swRegistration = reg;
                    console.info('Inline Service Worker registered.');
                    return swRegistration;
                } catch (err2) {
                    console.error('Failed to register inline Service Worker:', err2);
                    return null;
                }
            } 

            /* =========================
               Install Modal Logic (Adapted to React/Tailwind styling)
               ========================= */
            function ensureInstallModalExists() {
                if ($('pwa-install-modal')) return; 

                // Note: The React component will render the PWA prompt within the main app
                // However, we still need the global function to show it. 
                // We will rely on React's state management via window.setShowInstallPrompt.
            }

            // Global function to show the React-managed install modal
            function showInstallModal() {
                if (window.setShowInstallPrompt) {
                    window.setShowInstallPrompt(true);
                } else {
                    console.warn("React state setter not available for PWA modal.");
                }
            } 

            // Global function to hide the React-managed install modal
            function hideInstallModal() {
                if (window.setShowInstallPrompt) {
                    window.setShowInstallPrompt(false);
                }
            } 

            // Global function to handle the native install process
            async function onInstallNowClicked(e) {
                e && e.preventDefault && e.preventDefault(); 
                
                // 1. Show Loading UI in React component
                if (window.setInstallStatus) {
                    window.setInstallStatus('Starting installation...');
                }

                // 2. Try native prompt first
                if (deferredPrompt) {
                    try {
                        deferredPrompt.prompt();
                        const choice = await deferredPrompt.userChoice;
                        deferredPrompt = null; 
                        
                        if (choice.outcome === 'accepted') {
                            if (window.setInstallStatus) window.setInstallStatus('Finalizing native install...');
                            await new Promise(r => setTimeout(r, 3000)); // Simulate time for browser to complete
                        }
                    } catch (err) {
                        console.warn('Native prompt error or dismissed. Falling back.');
                    }
                } 

                // 3. Fallback / Complete cache operation
                await fallbackInstallSequence();

                // 4. Finalize UI
                if (window.setInstallStatus) {
                    window.setInstallStatus('App installed!');
                    setTimeout(hideInstallModal, 1500);
                }
                isAppInstalled = true;
            } 

            async function fallbackInstallSequence() {
                if (window.setInstallStatus) window.setInstallStatus('Registering Service Worker...');
                const reg = await registerServiceWorker();
                
                if (reg && reg.active) {
                    if (window.setInstallStatus) window.setInstallStatus('Caching Exness Bot files...');
                    // Ask SW to cache resources
                    try {
                        reg.active.postMessage({ type: 'CACHE_URLS', urls: PRECACHE_URLS });
                    } catch (e) {
                        console.warn('SW PostMessage failed, relying on install precache/fetch cache.');
                    }
                } else {
                    if (window.setInstallStatus) window.setInstallStatus('SW inactive: Offline support may be limited.');
                }
                
                // Show toast for iOS instructions if needed
                const ua = navigator.userAgent || '';
                if (/iphone|ipad|ipod/i.test(ua) && !window.matchMedia('(display-mode: standalone)').matches) {
                    if (window.setInstallStatus) window.setInstallStatus('Tap the Share button → Add to Home Screen to install on iOS');
                }
                await new Promise(r => setTimeout(r, 1000));
            }

            /* =========================
               Event Listeners & Initialization
               ========================= */

            // Capture the beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.info('beforeinstallprompt captured.');
            }); 

            // App installed event
            window.addEventListener('appinstalled', (evt) => {
                console.info('PWA installed event received.');
                isAppInstalled = true;
                if (window.setInstallStatus) {
                    window.setInstallStatus('App installed!');
                    setTimeout(hideInstallModal, 1500);
                }
            }); 

            window.addEventListener('load', () => {
                ensureManifest();
                registerServiceWorker(); // Register immediately on load
                // Any button with 'data-install-pwa' attribute or the IDs below will trigger the modal
                setupGetAppButtons();
            });

            function setupGetAppButtons() {
                const handler = (e) => {
                    e && e.preventDefault && e.preventDefault();
                    showInstallModal();
                }; 
                const ids = ['get-app-btn', 'get-mobile-app', 'getAppButton', 'install-pwa', 'get-app'];
                
                const interval = setInterval(() => {
                    let found = false;
                    ids.forEach(id => {
                        const el = $ (id) || document.querySelector(`#${id}`);
                        if (el) {
                            try { el.removeEventListener('click', handler); } catch (e) {}
                            el.addEventListener('click', handler);
                            found = true;
                        }
                    }); 
                    const nodes = document.querySelectorAll('[data-install-pwa]');
                    if (nodes.length > 0) {
                        nodes.forEach(n => { n.removeEventListener('click', handler); n.addEventListener('click', handler); }); 
                        found = true;
                    }
                    if (found) clearInterval(interval);
                }, 500);
            }

            /* =========================
               Public Helpers
               ========================= */
            window.onInstallNowClicked = onInstallNowClicked; // Exposed for React component
            window.showInstallModal = showInstallModal; // Exposed for React component
        })();
    </script>
    
    <!-- React Component -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const REDIRECT_URL = 'AI-Trading-Bot.html';
        const COINGECKO_API = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h';
        const EXNESS_LOGO_URL = 'https://placehold.co/192x192/0D1321/00A389?text=EXNESS';

        // --- Global Redirect Function with 15s Load ---
        const simulateLoadAndRedirect = (url, message = 'Initializing bot setup...') => {
            const overlay = document.getElementById('loading-overlay');
            if (!overlay) {
                window.location.href = url;
                return;
            }
            overlay.classList.add('active');
            let seconds = 15;
            const textElement = overlay.querySelector('p.text-xl');
            
            const updateText = () => {
                if (textElement) textElement.textContent = `${message} | Redirect in ${seconds}s`;
            };

            const interval = setInterval(() => {
                seconds -= 1;
                updateText();
                if (seconds <= 0) {
                    clearInterval(interval);
                    overlay.classList.remove('active');
                    window.location.href = url;
                }
            }, 1000);

            updateText();
        };

        // --- CoinGecko Data Fetcher ---
        const useMarketData = () => {
            const [marketData, setMarketData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchMarketData = async () => {
                    try {
                        const response = await fetch(COINGECKO_API);
                        if (!response.ok) throw new Error('Failed to fetch market data');
                        const data = await response.json();
                        setMarketData(data);
                    } catch (e) {
                        console.error("Market data fetch error:", e);
                        setError("Could not load live market data.");
                        // Fallback data structure
                        setMarketData([
                            { id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', current_price: 68000, price_change_percentage_24h: 1.5, market_cap: 1300000000000 },
                            { id: 'ethereum', symbol: 'eth', name: 'Ethereum', current_price: 3800, price_change_percentage_24h: -0.8, market_cap: 450000000000 },
                        ]);
                    } finally {
                        setLoading(false);
                    }
                };

                // Fetch immediately and set up a refresh interval
                fetchMarketData();
                const intervalId = setInterval(fetchMarketData, 60000); 

                return () => clearInterval(intervalId);
            }, []);

            return { marketData, loading, error };
        };

        // --- Components ---

        const NavButton = ({ text, onClick, isPrimary = false }) => (
            <button 
                onClick={onClick}
                className={`header-btn transition-transform ${isPrimary 
                    ? 'bg-exness-accent text-exness-bg-primary hover:bg-exness-accent/90' 
                    : 'bg-transparent text-exness-text hover:text-exness-accent'
                }`}
            >
                {text}
            </button>
        );

        const MenuPanel = ({ isOpen, onRedirect }) => {
            if (!isOpen) return null;

            const handleLogin = () => onRedirect("Redirecting to login and setup...", REDIRECT_URL);
            const handleStartFreeTrial = () => onRedirect("Starting free trial setup...", REDIRECT_URL);

            return (
                <div className="absolute right-0 mt-2 w-64 bg-exness-bg-secondary border border-exness-border rounded-xl shadow-2xl z-40 p-4">
                    <div className="space-y-3">
                        <button className="w-full text-left p-2 rounded-lg hover:bg-exness-bg-primary text-exness-accent" onClick={() => console.log('Connect Portfolio clicked')}>
                            Connect Portfolio
                        </button>
                        <button className="w-full text-left p-2 rounded-lg hover:bg-exness-bg-primary" onClick={handleLogin}>
                            Login ID
                        </button>
                        <button className="w-full text-left p-2 rounded-lg hover:bg-exness-bg-primary" onClick={() => console.log('Support clicked')}>
                            Support
                        </button>
                        <button className="w-full text-left p-2 rounded-lg hover:bg-exness-bg-primary" onClick={() => console.log('Connect wallet clicked')}>
                            Connect Wallet
                        </button>
                        <div className="pt-3 border-t border-exness-border">
                            <button 
                                className="w-full py-3 rounded-xl bg-exness-accent text-exness-bg-primary font-bold hover:bg-exness-accent/90"
                                onClick={handleStartFreeTrial}
                            >
                                Start Free Trial
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Header = ({ onRedirect, onShowInstall }) => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const menuRef = useRef(null);

            const handleMoreOptions = (e) => {
                e.stopPropagation();
                setIsMenuOpen(prev => !prev);
            }

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target)) {
                        setIsMenuOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, [menuRef]);

            return (
                <header className="sticky top-0 z-30 bg-exness-bg-primary/95 backdrop-blur-sm shadow-lg shadow-black/20">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                        {/* Logo */}
                        <div className="flex items-center space-x-2">
                            <img src={EXNESS_LOGO_URL} alt="Exness Logo" className="w-8 h-8 rounded-lg"/>
                            <span className="text-xl font-extrabold text-exness-text">Exness <span className="text-exness-accent">Bot</span></span>
                        </div>

                        {/* Desktop Navigation */}
                        <nav className="hidden md:flex items-center space-x-4" ref={menuRef}>
                            <NavButton text="Market Overview" onClick={() => document.getElementById('market-overview').scrollIntoView({ behavior: 'smooth' })} />
                            <NavButton text="Connect Portfolio" onClick={() => console.log('Connect Portfolio clicked')} />
                            <NavButton text="Login ID" onClick={() => onRedirect("Authenticating and redirecting...", REDIRECT_URL)} />
                            
                            <div className="relative">
                                <NavButton text="More Options" onClick={handleMoreOptions} />
                                <MenuPanel isOpen={isMenuOpen} onRedirect={onRedirect} />
                            </div>
                            <NavButton 
                                id="getAppButton" 
                                text="Get App" 
                                onClick={onShowInstall} 
                                isPrimary={true}
                                className="ml-4"
                            />
                        </nav>
                        
                        {/* Mobile Menu Button */}
                        <div className="md:hidden flex items-center">
                            <NavButton id="getAppButtonMobile" text="Get App" onClick={onShowInstall} isPrimary={true} />
                            <button 
                                onClick={handleMoreOptions} 
                                className="ml-3 p-2 rounded-lg bg-exness-bg-secondary hover:bg-exness-border transition-colors"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                            </button>
                            <div className="absolute top-16 right-4" ref={menuRef}>
                                <MenuPanel isOpen={isMenuOpen} onRedirect={onRedirect} />
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        const HeroSection = ({ onRedirect, onShowInstall }) => {
            const handleStart = () => onRedirect("Starting free trial deployment...", REDIRECT_URL);
            const handleLogin = () => onRedirect("Authenticating and redirecting...", REDIRECT_URL);

            return (
                <section className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-24 text-center">
                    <h1 className="text-5xl md:text-7xl font-extrabold text-exness-text leading-tight mb-6">
                        Auto-Trading Bot - <span className="text-exness-accent">Connect Portfolio</span>
                    </h1>
                    <p className="max-w-3xl mx-auto text-xl text-gray-400 mb-10">
                        Experience the disruption: Exness Auto-Trading Bot provides institutional-grade automated execution, deep market liquidity, and optimal price discovery, ensuring your trading is always efficient and profit-focused.
                    </p>
                    
                    <div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 max-w-lg mx-auto">
                        <button 
                            className="cta-button bg-exness-accent text-exness-bg-primary hover:bg-exness-accent/90"
                            onClick={handleStart}
                        >
                            Start Free Trial
                        </button>
                        <button 
                            className="cta-button bg-exness-bg-secondary text-exness-text border border-exness-border hover:bg-exness-border"
                            onClick={handleLogin}
                        >
                            Login ID
                        </button>
                    </div>

                    <p className="mt-8 text-sm text-gray-500 hover:text-exness-accent cursor-pointer" onClick={onShowInstall}>
                        <span className="underline" id="get-mobile-app">Get the Mobile App</span> for ultimate performance and offline access.
                    </p>
                </section>
            );
        };

        const MarketOverview = ({ marketData, loading, error }) => {
            const [selectedCoin, setSelectedCoin] = useState(null);
            
            // Load TradingView script when component mounts
            useEffect(() => {
                if (document.getElementById('tradingview-widget-script')) return;
                
                const script = document.createElement('script');
                script.src = 'https://s3.tradingview.com/tv.js';
                script.async = true;
                script.id = 'tradingview-widget-script';
                document.head.appendChild(script);
            }, []);

            // Function to load the TradingView chart for the selected coin
            const loadChart = (coinId, coinSymbol) => {
                setSelectedCoin({ id: coinId, symbol: coinSymbol.toUpperCase() });

                // Delay execution to ensure TradingView script is loaded
                setTimeout(() => {
                    if (typeof window.TradingView === 'undefined') return;
                    
                    new window.TradingView.widget({
                        "container_id": "tradingview_chart_container",
                        "autosize": true,
                        "symbol": `${coinSymbol.toUpperCase()}USD`, // Assuming symbol USD pair
                        "interval": "D",
                        "timezone": "Etc/UTC",
                        "theme": "dark",
                        "style": "1",
                        "locale": "en",
                        "toolbar_bg": "#f1f3f6",
                        "enable_publishing": false,
                        "allow_symbol_change": true,
                        "watchlist": [coinSymbol.toUpperCase()],
                        "studies": ["RSI@tv-basicstudies","MACD@tv-basicstudies","StochasticRSI@tv-basicstudies"],
                        "hide_side_toolbar": false,
                        "details": true,
                        "hotlist": false
                    });
                }, 500);
            };

            useEffect(() => {
                if (marketData.length > 0 && !selectedCoin) {
                    loadChart(marketData[0].id, marketData[0].symbol); // Load BTC chart on initial render
                }
            }, [marketData, selectedCoin]);

            const formatCurrency = (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2, minimumFractionDigits: 2 }).format(value);
            const formatPercentage = (value) => new Intl.NumberFormat('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value / 100);

            return (
                <section id="market-overview" className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
                    <h2 className="text-3xl font-bold mb-8 text-center">Live Prices & Market Overview</h2>

                    {/* Chart Container */}
                    <div className="bg-exness-bg-secondary p-4 md:p-6 rounded-xl shadow-xl border border-exness-border mb-8">
                        <h3 className="text-xl font-semibold mb-4">{selectedCoin ? `${selectedCoin.symbol} / USD Performance Chart` : 'Loading Chart...'}</h3>
                        <div id="tradingview_chart_container" className="h-96 w-full rounded-lg bg-exness-bg-primary">
                            {/* TradingView Widget will be injected here */}
                            {!selectedCoin && <div className="flex items-center justify-center h-full text-gray-500">Select a coin to view its chart.</div>}
                        </div>
                    </div>

                    {/* Top Coins List */}
                    <div className="bg-exness-bg-secondary p-4 md:p-6 rounded-xl shadow-xl border border-exness-border overflow-x-auto scroll-container">
                        <h3 className="text-xl font-semibold mb-4">Top Coins List (24h)</h3>
                        {loading && <div className="text-center py-4 text-gray-400">Loading market data...</div>}
                        {error && <div className="text-center py-4 text-exness-down">{error}</div>}
                        
                        {!loading && marketData.length > 0 && (
                            <table className="w-full text-left table-auto min-w-[700px]">
                                <thead>
                                    <tr className="border-b border-exness-border text-gray-400 text-sm font-medium uppercase tracking-wider">
                                        <th className="py-3 px-2">#</th>
                                        <th className="py-3 px-2">Coin</th>
                                        <th className="py-3 px-2 text-right">Price</th>
                                        <th className="py-3 px-2 text-right">24h Change</th>
                                        <th className="py-3 px-2 text-right">Market Cap</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {marketData.map((coin, index) => (
                                        <tr 
                                            key={coin.id} 
                                            className="border-b border-exness-border/50 cursor-pointer hover:bg-exness-bg-primary/50 transition-colors"
                                            onClick={() => loadChart(coin.id, coin.symbol)}
                                        >
                                            <td className="py-3 px-2 font-medium">{index + 1}</td>
                                            <td className="py-3 px-2 flex items-center space-x-2">
                                                <img src={coin.image || `https://placehold.co/24x24/0D1321/FFFFFF?text=${coin.symbol.toUpperCase().slice(0, 1)}`} 
                                                     alt={coin.name} className="w-6 h-6 rounded-full"/>
                                                <span className="font-semibold text-exness-text">{coin.name}</span>
                                                <span className="text-gray-500 uppercase text-xs">{coin.symbol}</span>
                                            </td>
                                            <td className="py-3 px-2 text-right font-mono">{formatCurrency(coin.current_price)}</td>
                                            <td className={`py-3 px-2 text-right font-medium ${coin.price_change_percentage_24h >= 0 ? 'text-exness-up' : 'text-exness-down'}`}>
                                                {formatPercentage(coin.price_change_percentage_24h)}
                                            </td>
                                            <td className="py-3 px-2 text-right text-gray-400">{formatCurrency(coin.market_cap).split('.')[0]}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        )}
                    </div>
                </section>
            );
        };

        const Footer = ({ onShowInstall }) => (
            <footer className="bg-exness-bg-secondary border-t border-exness-border mt-12">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
                        <div>
                            <h4 className="font-bold text-lg mb-4 text-exness-accent">Product</h4>
                            <ul className="space-y-2 text-sm text-gray-400">
                                <li><a href="#" className="hover:text-exness-text transition-colors">Auto-Trading</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Portfolio Connect</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Live Prices</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="font-bold text-lg mb-4 text-exness-accent">Company</h4>
                            <ul className="space-y-2 text-sm text-gray-400">
                                <li><a href="#" className="hover:text-exness-text transition-colors">About Us</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Security</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Careers</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="font-bold text-lg mb-4 text-exness-accent">Support</h4>
                            <ul className="space-y-2 text-sm text-gray-400">
                                <li><a href="#" className="hover:text-exness-text transition-colors">Help Center</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Contact Support</a></li>
                                <li className="cursor-pointer" onClick={onShowInstall}><span id="get-app" className="hover:text-exness-text transition-colors">Get App</span></li>
                            </ul>
                        </div>
                        <div className="col-span-2 md:col-span-1">
                            <h4 className="font-bold text-lg mb-4 text-exness-accent">Legal</h4>
                            <ul className="space-y-2 text-sm text-gray-400">
                                <li><a href="#" className="hover:text-exness-text transition-colors">Terms of Use</a></li>
                                <li><a href="#" className="hover:text-exness-text transition-colors">Privacy Policy</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div className="mt-12 pt-8 border-t border-exness-border/50 text-center text-sm text-gray-500">
                        © {new Date().getFullYear()} Exness Auto-Trading Bot. All rights reserved.
                    </div>
                </div>
            </footer>
        );

        // --- PWA Install Prompt Component ---
        const PWAInstallPrompt = ({ show, onClose, onInstall }) => {
            const [status, setStatus] = useState('Ready to install');

            // Expose status setter to global PWA script
            useEffect(() => {
                window.setInstallStatus = setStatus;
                return () => { delete window.setInstallStatus; };
            }, []);

            if (!show) return null;

            return (
                <div 
                    className="fixed inset-0 flex items-center justify-center bg-black/70 z-[2147483647]"
                    onClick={onClose}
                >
                    <div 
                        className="bg-exness-bg-secondary w-full max-w-sm rounded-xl p-6 shadow-2xl border border-exness-border m-4"
                        onClick={(e) => e.stopPropagation()} // Prevent closing when clicking inside
                    >
                        <div className="flex items-center space-x-3 mb-4">
                            <img src={EXNESS_LOGO_URL} alt="Exness Logo" className="w-10 h-10 rounded-lg"/>
                            <h3 className="text-2xl font-bold text-exness-text">Install App</h3>
                        </div>
                        <p className="text-gray-400 mb-6">Install Exness Auto-Trading Bot for the best experience, offline access, and dedicated home-screen icon.</p>
                        
                        <div className="bg-exness-bg-primary p-3 rounded-lg border border-exness-border mb-6">
                            <p className="text-sm font-semibold text-exness-accent">Status:</p>
                            <p className="text-md text-exness-text">{status}</p>
                        </div>

                        <div className="flex justify-end gap-3">
                            <button 
                                className="px-4 py-2 rounded-xl text-sm font-semibold text-gray-400 hover:text-exness-text transition-colors" 
                                onClick={onClose}
                            >
                                Maybe Later
                            </button>
                            <button 
                                className="px-4 py-2 rounded-xl text-sm font-bold bg-exness-accent text-exness-bg-primary hover:bg-exness-accent/90 disabled:opacity-50" 
                                onClick={onInstall}
                                disabled={status === 'App installed!'}
                            >
                                Install Now
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        

        // --- Main App Component ---
        const App = () => {
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const { marketData, loading, error } = useMarketData();
            
            // Expose the state setter globally for the PWA script to control the modal
            useEffect(() => {
                window.setShowInstallPrompt = setShowInstallPrompt;
                return () => { delete window.setShowInstallPrompt; };
            }, []);

            return (
                <div className="min-h-screen flex flex-col">
                    
                    {/* Loading Overlay for 15s Redirect */}
                    <div id="loading-overlay">
                        <div className="spinner mb-4"></div>
                        <p className="text-exness-accent font-semibold text-xl">Initializing bot setup...</p>
                        <p className="mt-2 text-gray-400 text-sm">Do not navigate away.</p>
                    </div>

                    <Header onRedirect={simulateLoadAndRedirect} onShowInstall={() => setShowInstallPrompt(true)} />
                    
                    <main className="flex-grow">
                        <HeroSection onRedirect={simulateLoadAndRedirect} onShowInstall={() => setShowInstallPrompt(true)} />
                        <MarketOverview marketData={marketData} loading={loading} error={error} />
                    </main>

                    <Footer onShowInstall={() => setShowInstallPrompt(true)} />

                    {/* PWA Install Prompt (as requested) */}
                    <PWAInstallPrompt
                        show={showInstallPrompt}
                        onClose={() => setShowInstallPrompt(false)}
                        onInstall={window.onInstallNowClicked} // Use the global PWA install handler
                    />
                </div>
            );
        };

        // Initialize React App
        window.onload = function () {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                ReactDOM.createRoot(rootElement).render(<App />);
            } else {
                console.error("Root element not found.");
            }
        };
    </script>

</body>
</html>