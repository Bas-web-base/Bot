<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exness Auto-Trading Bot</title>
    
    <!-- Theme Color and PWA Meta -->
    <meta name="theme-color" content="#0D1321">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- The manifest link tag will be dynamically generated by the PWA script below -->
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* --- Base Dark Mode Theme (Exness Inspired) --- */
        :root {
            --primary-bg: #0D1321; /* Dark background */
            --secondary-bg: #1A2744; /* Card/section background (dark blue/purple) */
            --primary-text: #E5E7EB; /* Light text */
            --accent-color: #00A389; /* Green accent (Exness brand color) */
            --hover-color: #00C4A4;
            --border-color: #1E3557;
            --muted-text: #9CA3AF;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Utility classes matching Tailwind logic */
        .btn-primary {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 10px 18px;
            border-radius: 12px;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 10px rgba(0, 163, 137, 0.3);
        }
        .btn-primary:hover {
            background-color: var(--hover-color);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 600;
        }
        .btn-secondary:hover {
            background-color: rgba(0, 163, 137, 0.1);
        }
        
        /* Loading Overlay Style */
        #loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(13, 19, 33, 0.95); /* Semi-transparent dark bg */
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: opacity 0.3s;
            opacity: 0;
        }
        #loading-overlay.active {
            display: flex;
            opacity: 1;
        }
        .loader {
            border: 4px solid var(--secondary-bg);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <!-- PWA Installation Script (Adapted from provided functions.html) -->
    <script>
        (function initPWAInstaller() {
            'use strict';
            
            /* =========================
            Configuration (Exness specific)
            ========================= */
            const CACHE_NAME = 'exness-bot-pwa-v1';
            // Explicitly cache both the main page and the target redirection page
            const PRECACHE_URLS = ['/', '/index.html', '/AI-Trading-Bot.html'];
            const APP_NAME = 'Exness Auto-Trading Bot';
            const APP_SHORT_NAME = 'Exness';
            const THEME_COLOR = '#0D1321';
            const BACKGROUND_COLOR = '#0D1321';
            
            // Placeholder Exness-style icon (PNG is required, not SVG)
            const ICON_PNG_URL = 'https://placehold.co/512x512/00A389/ffffff?text=EX'; 

            /* =========================
            State & Helpers
            ========================= */
            let deferredPrompt = null;
            let isAppInstalled = false;
            let manifestBlobUrl = null;
            let swRegistration = null;

            function $ (id) { return document.getElementById(id); }
            function createEl (tag, props = {}, children = []) {
                const el = document.createElement(tag);
                Object.keys(props).forEach(k => {
                    if (k === 'style') Object.assign(el.style, props[k]);
                    else if (k === 'attrs') Object.keys(props.attrs).forEach(a => el.setAttribute(a, props.attrs[a]));
                    else el[k] = props[k];
                });
                (Array.isArray(children) ? children : [children]).forEach(c => {
                    if (typeof c === 'string') el.appendChild(document.createTextNode(c));
                    else if (c) el.appendChild(c);
                });
                return el;
            }

            /* =========================
            Manifest Management
            ========================= */
            function ensureManifest() {
                try {
                    const existing = document.querySelector('link[rel="manifest"]');
                    if (existing) existing.parentNode.removeChild(existing);

                    const manifest = {
                        name: APP_NAME,
                        short_name: APP_SHORT_NAME,
                        start_url: '/index.html',
                        scope: '/',
                        display: 'standalone',
                        orientation: 'portrait',
                        theme_color: THEME_COLOR,
                        background_color: BACKGROUND_COLOR,
                        icons: [
                            { src: ICON_PNG_URL, sizes: '192x192', type: 'image/png', purpose: 'any' },
                            { src: ICON_PNG_URL, sizes: '512x512', type: 'image/png', purpose: 'maskable any' }
                        ],
                        description: 'Exness Auto-Trading Bot - Automated trading for a seamless experience.'
                    };

                    const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                    manifestBlobUrl = URL.createObjectURL(blob);
                    const link = createEl('link', { attrs: { rel: 'manifest', href: manifestBlobUrl }, id: 'pwa-manifest-link' });
                    document.head.appendChild(link);
                    console.info('PWA manifest injected/updated.');
                } catch (err) {
                    console.error('Failed to create manifest:', err);
                }
            }

            /* =========================
            Service Worker (Inline Fallback)
            ========================= */
            async function registerServiceWorker() {
                if (!('serviceWorker' in navigator)) return null;

                // Inline worker: provides basic caching for specified resources
                const swCode = `
                    const CACHE_NAME = '${CACHE_NAME}';
                    const PRECACHE = ${JSON.stringify(PRECACHE_URLS)}; 
                    self.addEventListener('install', (evt) => {
                        evt.waitUntil((async () => {
                            try {
                                const c = await caches.open(CACHE_NAME);
                                await c.addAll(PRECACHE);
                            } catch (e) {
                                console.log("Precache failed:", e);
                            }
                            self.skipWaiting();
                        })());
                    }); 

                    self.addEventListener('activate', (evt) => {
                        evt.waitUntil((async () => {
                            const keys = await caches.keys();
                            await Promise.all(keys.map(k => k === CACHE_NAME ? Promise.resolve() : caches.delete(k)));
                            await self.clients.claim();
                        })());
                    }); 

                    self.addEventListener('fetch', (evt) => {
                        evt.respondWith((async () => {
                            try {
                                const cache = await caches.open(CACHE_NAME);
                                const cached = await cache.match(evt.request);
                                if (cached) return cached;
                                const response = await fetch(evt.request);
                                if (evt.request.method === 'GET' && response && response.status === 200 && evt.request.url.startsWith(self.location.origin)) {
                                    cache.put(evt.request, response.clone()).catch(()=>{});
                                }
                                return response;
                            } catch (err) {
                                if (evt.request.mode === 'navigate') {
                                    const cache = await caches.open(CACHE_NAME);
                                    // Fallback to index.html for navigation requests when offline
                                    const fallback = await cache.match('/index.html') || cache.match('/');
                                    if (fallback) return fallback;
                                }
                                return new Response('Offline', { status: 503, statusText: 'Offline' });
                            }
                        })());
                    });
                `; 

                try {
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const blobUrl = URL.createObjectURL(blob);
                    const reg = await navigator.serviceWorker.register(blobUrl);
                    swRegistration = reg;
                    console.info('Inline Service Worker registered.');
                    return swRegistration;
                } catch (err) {
                    console.error('Failed to register inline Service Worker:', err);
                    return null;
                }
            } 
            
            /* =========================
            Modal UI (React-agnostic, for PWA install)
            ========================= */
            function ensureInstallModalExists() {
                if ($('pwa-install-modal')) return;

                const accentColor = 'var(--accent-color)';
                const primaryBg = 'var(--primary-bg)';
                const secondaryBg = 'var(--secondary-bg)';
                const primaryText = 'var(--primary-text)';

                const overlay = createEl('div', {
                    id: 'pwa-install-modal',
                    style: {
                        position: 'fixed', inset: '0', display: 'none', alignItems: 'center', justifyContent: 'center',
                        background: 'rgba(0,0,0,0.7)', zIndex: 2147483647
                    }
                });

                const card = createEl('div', {
                    id: 'pwa-install-modal-card',
                    style: {
                        width: '380px', maxWidth: '94%', background: secondaryBg, borderRadius: '16px',
                        padding: '24px', boxShadow: '0 10px 40px rgba(0,0,0,0.7)', fontFamily: 'Inter, sans-serif',
                        color: primaryText, border: `1px solid var(--border-color)`
                    }
                });

                const headerRow = createEl('div', { style: { display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' } });
                const logoImg = createEl('img', {
                    attrs: { src: ICON_PNG_URL, alt: 'Exness Logo' },
                    style: { width: '48px', height: '48px', borderRadius: '10px', objectFit: 'cover', border: `2px solid ${accentColor}` }
                });
                const title = createEl('div', { innerText: 'Install Exness Auto-Trading Bot', style: { fontSize: '20px', fontWeight: 800, color: accentColor } });
                
                headerRow.appendChild(logoImg);
                headerRow.appendChild(title);

                const desc = createEl('div', {
                    innerText: 'Install the full Progressive Web App for the best experience, including faster loading, offline support, and a dedicated home-screen icon.',
                    style: { fontSize: '14px', marginTop: '8px', color: 'var(--muted-text)' }
                });

                // Progress container
                const progressContainer = createEl('div', { id: 'pwa-install-progress', style: { display: 'none', marginTop: '20px' } });
                const progressOuter = createEl('div', { style: { width: '100%', height: '12px', background: primaryBg, borderRadius: '6px', overflow: 'hidden' }});
                const progressBar = createEl('div', { id: 'pwa-install-progress-bar', style: { width: '0%', height: '100%', background: accentColor, transition: 'width 0.4s ease-in-out' }});
                progressOuter.appendChild(progressBar);
                const progressText = createEl('div', { id: 'pwa-install-progress-text', innerText: 'Ready to install', style: { fontSize: '12px', marginTop: '8px', color: 'var(--muted-text)' }});
                progressContainer.appendChild(progressOuter);
                progressContainer.appendChild(progressText);
                
                // Actions
                const actions = createEl('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end', marginTop: '20px' }});
                const cancelBtn = createEl('button', { id: 'cancel-install-btn', innerText: 'Maybe Later', className: 'btn-secondary', style: { padding: '10px 18px', border: `1px solid var(--border-color)`, color: primaryText }});
                const installBtn = createEl('button', { id: 'install-now-btn', innerText: 'Install Now', className: 'btn-primary', style: { padding: '10px 18px' }});

                actions.appendChild(cancelBtn);
                actions.appendChild(installBtn);

                card.appendChild(headerRow);
                card.appendChild(desc);
                card.appendChild(progressContainer);
                card.appendChild(actions);

                overlay.appendChild(card);
                document.body.appendChild(overlay);

                // Events
                cancelBtn.addEventListener('click', hideInstallModal);
                installBtn.addEventListener('click', onInstallNowClicked);
                overlay.addEventListener('click', (e) => { if (e.target === overlay) hideInstallModal(); });
            }

            function showInstallModal() {
                ensureInstallModalExists();
                const overlay = $('pwa-install-modal');
                if (!overlay) return;
                overlay.style.display = 'flex';
                // Reset state
                const prog = $('pwa-install-progress'); if (prog) prog.style.display = 'none';
                const bar = $('pwa-install-progress-bar'); if (bar) bar.style.width = '0%';
                const text = $('pwa-install-progress-text'); if (text) text.innerText = 'Ready to install';
                const installBtn = $('install-now-btn'); 
                if (installBtn) { 
                    installBtn.innerText = deferredPrompt ? 'Install Now' : 'Get App'; 
                    installBtn.disabled = false; 
                    installBtn.style.opacity = '1';
                    installBtn.className = 'btn-primary'; // Re-apply class to reset background color
                }
            }

            function hideInstallModal() {
                const overlay = $('pwa-install-modal');
                if (overlay) overlay.style.display = 'none';
            }

            async function onInstallNowClicked(e) {
                e && e.preventDefault && e.preventDefault();

                const installBtn = $('install-now-btn');
                const cancelBtn = $('cancel-install-btn');
                const progress = $('pwa-install-progress');
                const progressBar = $('pwa-install-progress-bar');
                const progressText = $('pwa-install-progress-text');

                if (installBtn) { installBtn.disabled = true; installBtn.style.opacity = '0.6'; installBtn.innerText = 'Installing...'; }
                if (cancelBtn) cancelBtn.disabled = true;
                if (progress) progress.style.display = 'block';

                // Try native prompt first
                if (deferredPrompt) {
                    try {
                        deferredPrompt.prompt();
                        const choice = await deferredPrompt.userChoice;
                        deferredPrompt = null; 
                        
                        if (choice.outcome === 'accepted') {
                            if (progressBar) progressBar.style.width = '50%';
                            if (progressText) progressText.innerText = 'Native install accepted. Finalizing files...';
                        } else {
                            if (progressText) progressText.innerText = 'Native prompt dismissed. Falling back to offline install...';
                        }
                    } catch (err) {
                        console.warn('deferredPrompt.prompt() error', err);
                    }
                } 

                // Run fallback (SW registration and caching)
                if (progressText) progressText.innerText = 'Ensuring Service Worker and caching files...';
                await fallbackInstallSequence(progressBar, progressText);
                
                finalizeInstallUI(true, maybeShowIOSInstructions());
            }

            async function fallbackInstallSequence(progressBar, progressText) {
                try {
                    const reg = swRegistration || await registerServiceWorker();
                    if (reg && reg.active) {
                        if (progressBar) progressBar.style.width = '70%';
                        progressText && (progressText.innerText = 'Service Worker active. Caching resources...');
                        // Attempt to cache all precache URLs
                        const cache = await caches.open(CACHE_NAME);
                        await cache.addAll(PRECACHE_URLS);
                    } else {
                        progressText && (progressText.innerText = 'Service Worker inactive. Caching via Cache API...');
                        const cache = await caches.open(CACHE_NAME);
                        await cache.addAll(PRECACHE_URLS);
                    }
                    if (progressBar) progressBar.style.width = '100%';
                    progressText && (progressText.innerText = 'Installation successful. App files cached!');
                    await new Promise(r => setTimeout(r, 700));
                } catch (err) {
                    console.error('Install sequence error:', err);
                    progressText && (progressText.innerText = 'Installation failed or limited offline functionality.');
                    await new Promise(r => setTimeout(r, 700));
                }
            }

            function finalizeInstallUI(success = true, extraText = '') {
                const installBtn = $('install-now-btn');
                const cancelBtn = $('cancel-install-btn');
                const progressText = $('pwa-install-progress-text');

                if (installBtn) {
                    installBtn.innerText = success ? 'App Installed' : 'Install Failed';
                    installBtn.className = success ? 'btn-primary bg-green-600 hover:bg-green-700' : 'btn-primary bg-red-600 hover:bg-red-700';
                    installBtn.disabled = true;
                }
                if (cancelBtn) cancelBtn.disabled = false;
                if (progressText) progressText.innerText = success ? `App installed ${extraText}` : 'Installation failed';
                isAppInstalled = !!success;

                setTimeout(hideInstallModal, 1800);
            }

            function maybeShowIOSInstructions() {
                const ua = navigator.userAgent || '';
                if (/iphone|ipad|ipod/i.test(ua) && !window.matchMedia('(display-mode: standalone)').matches) {
                    return 'â€” Tap the Share button and select "Add to Home Screen" on iOS.';
                }
                return '';
            }
            
            function setupGetAppButtons() {
                const handler = (e) => {
                    e && e.preventDefault && e.preventDefault();
                    showInstallModal();
                };

                // Elements the user specified (Get Mobile App, Get App, and others)
                const ids = ['get-app-btn', 'get-mobile-app', 'getApp', 'getMobileApp', 'install-pwa', 'getAppButton', 'get-app'];
                ids.forEach(id => {
                    const el = $(id) || document.querySelector(`#${id}`);
                    if (el) {
                        try { el.removeEventListener('click', handler); } catch (e) {}
                        el.addEventListener('click', handler);
                    }
                });
            }

            /* =========================
            Initialization & Listeners
            ========================= */
            function init() {
                ensureManifest();
                registerServiceWorker().then(reg => {
                    swRegistration = reg;
                    // Wait for the DOM to be ready to attach button handlers
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', setupGetAppButtons);
                    } else {
                        setupGetAppButtons();
                    }
                }).catch(err => console.error('SW init failed:', err));

                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    console.info('beforeinstallprompt captured.');
                    // The React component can check this flag to enable a "Get App" style change if needed.
                });

                window.addEventListener('appinstalled', (evt) => {
                    console.info('PWA installed event received:', evt);
                    isAppInstalled = true;
                    // If modal is open, finalize UI
                    if ($('pwa-install-modal').style.display === 'flex') {
                        finalizeInstallUI(true);
                    }
                });
            }
            
            // Public helper for React to call
            window.pwaInstaller = {
                showInstallModal: showInstallModal
            };

            // Start initialization
            init();
        })();
    </script>
    
    <!-- Global Loading and Redirection Function -->
    <script>
        function simulateLoadAndRedirect(url, message) {
            const overlay = document.getElementById('loading-overlay');
            const statusText = document.getElementById('loading-status');
            
            if (overlay) {
                overlay.classList.add('active');
                if (statusText) statusText.textContent = message || 'Connecting to Exness Trading Bot...';
            }
            
            console.log(message || 'Redirecting...');
            
            let seconds = 15;
            const timerText = overlay?.querySelector('p.mt-2');
            if (timerText) timerText.textContent = `Please wait ${seconds} seconds.`;
            
            const interval = setInterval(() => {
                seconds -= 1;
                if (timerText) timerText.textContent = `Redirecting in ${seconds} seconds...`;
                
                if (seconds <= 0) {
                    clearInterval(interval);
                    if (overlay) overlay.classList.remove('active');
                    // Navigate to the target URL
                    try { window.location.href = url; } catch (e) { window.open(url, '_self'); }
                }
            }, 1000);
        }
    </script>

    <!-- React Application -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Core Components ---

        const ExnessLogo = () => (
            <div className="flex items-center text-2xl font-extrabold text-white">
                <div className="w-8 h-8 rounded-lg bg-white flex items-center justify-center mr-2">
                    <span className="text-xl font-black" style={{ color: 'var(--accent-color)' }}>EX</span>
                </div>
                Exness <span className="ml-1 text-sm font-light text-gray-400">Bot</span>
            </div>
        );

        const LoadingOverlay = () => (
            <div id="loading-overlay">
                <div className="loader"></div>
                <h2 id="loading-status" className="text-xl font-bold mt-6 text-white"></h2>
                <p className="mt-2 text-gray-400 text-sm"></p>
            </div>
        );

        const Header = ({ onShowMenu }) => (
            <header className="fixed top-0 left-0 w-full z-30 bg-[rgba(13,19,33,0.95)] backdrop-blur-sm border-b border-[var(--border-color)]">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                    <ExnessLogo />
                    <div className="flex items-center space-x-4">
                        <button 
                            className="btn-primary text-sm shadow-lg hidden sm:block"
                            id="get-mobile-app"
                            onClick={window.pwaInstaller.showInstallModal}
                        >
                            Get Mobile App
                        </button>
                        <button 
                            className="p-2 rounded-lg bg-[var(--secondary-bg)] hover:bg-[var(--border-color)] transition"
                            onClick={onShowMenu}
                        >
                            <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>
        );

        const MegaMenu = ({ isVisible, onClose }) => {
            if (!isVisible) return null;

            const menuItems = [
                { name: "Connect Portfolio", action: () => simulateLoadAndRedirect('AI-Trading-Bot.html', 'Connecting Portfolio...') },
                { name: "Login ID", action: () => simulateLoadAndRedirect('AI-Trading-Bot.html', 'Logging in...') },
                { name: "Start Free Trial", action: () => simulateLoadAndRedirect('AI-Trading-Bot.html', 'Starting Free Trial...') },
                { name: "Market Overview", action: onClose, isExternal: false },
                { name: "Support", url: "https://www.exness.com/support/", isExternal: true },
                { name: "Connect Wallet", action: () => alert("Connecting to Wallet...") },
                { name: "Get Mobile App", action: () => window.pwaInstaller.showInstallModal(), isInstall: true },
            ];

            return (
                <div className="fixed inset-0 z-40 bg-[rgba(0,0,0,0.8)] flex justify-end transition-opacity duration-300" onClick={onClose}>
                    <div 
                        className="w-full sm:w-80 bg-[var(--secondary-bg)] h-full overflow-y-auto shadow-2xl p-6 transform transition-transform duration-300 translate-x-0"
                        onClick={e => e.stopPropagation()}
                    >
                        <div className="flex justify-between items-center mb-6 border-b border-[var(--border-color)] pb-4">
                            <ExnessLogo />
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-[var(--border-color)] text-white">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        
                        <div className="space-y-3">
                            {menuItems.map(item => (
                                <button
                                    key={item.name}
                                    className={`w-full text-left p-3 rounded-lg font-semibold transition ${
                                        item.isInstall ? 'bg-[var(--accent-color)] text-[var(--primary-bg)]' : 'hover:bg-[var(--border-color)] text-white'
                                    }`}
                                    onClick={() => { onClose(); item.action(); }}
                                >
                                    {item.name}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Footer = () => (
            <footer className="w-full bg-[var(--secondary-bg)] mt-auto border-t border-[var(--border-color)] text-xs text-[var(--muted-text)] p-6 text-center">
                <p>&copy; {new Date().getFullYear()} Exness Auto-Trading Bot. Trading involves significant risk. The information provided is for educational purposes only.</p>
                <div className="flex justify-center space-x-4 mt-2">
                    <a href="#" className="hover:text-[var(--accent-color)] transition">Legal Documents</a>
                    <a href="#" className="hover:text-[var(--accent-color)] transition">Risk Disclosure</a>
                    <a href="https://www.exness.com/support/" className="hover:text-[var(--accent-color)] transition">Support</a>
                </div>
            </footer>
        );
        
        const MarketDataDisplay = ({ data, onSelectCoin }) => {
            if (!data || data.length === 0) return <p className="text-center text-[var(--muted-text)]">Loading market data...</p>;

            return (
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-[var(--border-color)]">
                        <thead>
                            <tr className="text-left text-sm text-[var(--muted-text)] uppercase">
                                <th className="py-3 px-2 sm:px-6">#</th>
                                <th className="py-3 px-2 sm:px-6">Coin</th>
                                <th className="py-3 px-2 sm:px-6 text-right">Price</th>
                                <th className="py-3 px-2 sm:px-6 text-right">24h %</th>
                                <th className="py-3 px-2 sm:px-6 hidden sm:table-cell text-right">Mkt Cap</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-[var(--border-color)]">
                            {data.slice(0, 10).map((coin, index) => {
                                const priceChange = coin.price_change_percentage_24h;
                                const changeColor = priceChange >= 0 ? 'text-green-500' : 'text-red-500';
                                return (
                                    <tr key={coin.id} className="hover:bg-[var(--secondary-bg)] cursor-pointer transition" onClick={() => onSelectCoin(coin.symbol.toUpperCase())}>
                                        <td className="py-3 px-2 sm:px-6">{index + 1}</td>
                                        <td className="py-3 px-2 sm:px-6 font-semibold flex items-center">
                                            <img src={coin.image} alt={coin.name} className="w-6 h-6 mr-2 rounded-full" />
                                            {coin.symbol.toUpperCase()}
                                        </td>
                                        <td className="py-3 px-2 sm:px-6 text-right">${coin.current_price.toLocaleString('en-US')}</td>
                                        <td className={`py-3 px-2 sm:px-6 text-right font-medium ${changeColor}`}>
                                            {priceChange ? priceChange.toFixed(2) : '0.00'}%
                                        </td>
                                        <td className="py-3 px-2 sm:px-6 hidden sm:table-cell text-right text-[var(--muted-text)]">
                                            ${(coin.market_cap / 1e9).toFixed(2)}B
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const [showMenu, setShowMenu] = useState(false);
            const [marketData, setMarketData] = useState([]);
            const [selectedSymbol, setSelectedSymbol] = useState('BTCUSD');

            const handleToggleMenu = () => setShowMenu(prev => !prev);
            
            // Function to handle the 15-second redirect
            const handleRedirect = useCallback((url, message) => {
                // Call the globally exposed JS function
                if (window.simulateLoadAndRedirect) {
                    window.simulateLoadAndRedirect(url, message);
                } else {
                    alert('Redirect function not ready. Navigating immediately.');
                    window.location.href = url;
                }
            }, []);

            // 1. Fetch Market Data (CoinGecko)
            useEffect(() => {
                const fetchMarketData = async () => {
                    try {
                        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false');
                        if (!response.ok) throw new Error('Failed to fetch market data');
                        const data = await response.json();
                        setMarketData(data);
                    } catch (error) {
                        console.error('API Error:', error);
                        // Fallback data structure for display
                        setMarketData([
                            { id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', image: 'https://placehold.co/60x60/8B80F9/ffffff?text=BTC', current_price: 60000, market_cap: 1200000000000, price_change_percentage_24h: 1.5 },
                            { id: 'ethereum', symbol: 'eth', name: 'Ethereum', image: 'https://placehold.co/60x60/3C3C3D/ffffff?text=ETH', current_price: 3000, market_cap: 360000000000, price_change_percentage_24h: -0.8 },
                        ]);
                    }
                };

                fetchMarketData();
                const interval = setInterval(fetchMarketData, 60000); // Update every minute
                return () => clearInterval(interval);
            }, []);

            // 2. Embed TradingView Widget
            useEffect(() => {
                if (window.TradingView) return; // Prevent re-embedding

                const script = document.createElement('script');
                script.src = 'https://s3.tradingview.com/tv.js';
                script.onload = () => {
                    if (document.getElementById('tradingview-widget-container')) {
                        new window.TradingView.widget(
                            {
                                "autosize": true,
                                "symbol": selectedSymbol,
                                "interval": "1",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "toolbar_bg": "var(--secondary-bg)",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "tradingview-widget-container"
                            }
                        );
                    }
                };
                document.head.appendChild(script);

                // Initialize widget when symbol changes
                if (window.TradingView && document.getElementById('tradingview-widget-container')) {
                     new window.TradingView.widget({
                        "autosize": true,
                        "symbol": selectedSymbol,
                        "interval": "1",
                        "timezone": "Etc/UTC",
                        "theme": "dark",
                        "style": "1",
                        "locale": "en",
                        "toolbar_bg": "var(--secondary-bg)",
                        "enable_publishing": false,
                        "allow_symbol_change": true,
                        "container_id": "tradingview-widget-container"
                    });
                }
            }, [selectedSymbol]);
            
            // Function to update the chart on coin click
            const handleSelectCoin = (symbol) => {
                // TradingView uses pairs like BTCUSD. CoinGecko gives base symbols.
                const tvSymbol = symbol + 'USD'; 
                setSelectedSymbol(tvSymbol);
            };

            return (
                <div className="flex flex-col min-h-screen">
                    <Header onShowMenu={handleToggleMenu} />
                    <MegaMenu isVisible={showMenu} onClose={() => setShowMenu(false)} />
                    <main className="flex-grow pt-16">
                        {/* Hero Section - Exness LandingPage Style */}
                        <section className="py-20 sm:py-32 bg-[var(--primary-bg)] px-4">
                            <div className="max-w-7xl mx-auto text-center">
                                <h1 className="text-4xl sm:text-6xl font-extrabold leading-tight tracking-tight text-white">
                                    <span style={{ color: 'var(--accent-color)' }}>Auto-Trading</span> Bot
                                </h1>
                                <h2 className="text-xl sm:text-3xl text-[var(--muted-text)] mt-4 max-w-3xl mx-auto">
                                    Trade with Precision. Execute Strategies with Zero Hesitation.
                                </h2>
                                <p className="text-lg text-gray-400 mt-6 max-w-4xl mx-auto">
                                    Exness Auto-Trading Bot offers institutional-grade speed and reliability. 
                                    Connect your portfolio, choose from proprietary algorithms, and start trading 
                                    crypto, forex, and commodities automatically. No coding required.
                                </p>
                                <div className="mt-10 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                                    <button 
                                        className="btn-primary text-lg"
                                        onClick={() => handleRedirect('AI-Trading-Bot.html', 'Starting Free Trial...')}
                                    >
                                        Start Free Trial
                                    </button>
                                    <button 
                                        className="btn-secondary text-lg"
                                        onClick={() => handleRedirect('AI-Trading-Bot.html', 'Connecting Portfolio...')}
                                    >
                                        Connect Portfolio
                                    </button>
                                    <button 
                                        className="btn-secondary text-lg hidden sm:block"
                                        onClick={() => handleRedirect('AI-Trading-Bot.html', 'Logging in...')}
                                    >
                                        Login ID
                                    </button>
                                </div>
                            </div>
                        </section>

                        {/* Market Overview Section */}
                        <section className="py-16 sm:py-24 bg-[var(--secondary-bg)] px-4">
                            <div className="max-w-7xl mx-auto">
                                <h3 className="text-3xl font-bold text-white mb-8 border-b border-[var(--border-color)] pb-4">
                                    Market Overview & Live Prices
                                </h3>
                                
                                {/* TradingView Chart */}
                                <div className="bg-[var(--primary-bg)] p-4 rounded-xl shadow-2xl h-80 mb-12">
                                    <div id="tradingview-widget-container" className="h-full">
                                        {/* TradingView widget loads here */}
                                        <div className="text-center text-[var(--muted-text)] pt-16">Loading Live Price Chart for {selectedSymbol}...</div>
                                    </div>
                                </div>

                                {/* Top Coins List */}
                                <div className="bg-[var(--primary-bg)] p-0 sm:p-6 rounded-xl shadow-2xl">
                                    <h4 className="text-xl font-semibold mb-4 p-4 sm:p-0">Top 10 Cryptocurrencies</h4>
                                    <MarketDataDisplay data={marketData} onSelectCoin={handleSelectCoin} />
                                </div>

                            </div>
                        </section>
                        
                    </main>
                    <Footer />
                    <LoadingOverlay />
                </div>
            );
        };

        // Render the App
        window.onload = function () {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                ReactDOM.createRoot(rootElement).render(<App />);
            } else {
                console.error("Root element not found.");
            }
        };
    </script>
</body>
</html>
