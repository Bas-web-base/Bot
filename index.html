<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exness Auto-Trading Bot</title>
    
    <!-- Theme Color and PWA Meta -->
    <meta name="theme-color" content="#0D1321">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- The manifest link tag will be dynamically generated by the PWA script below -->
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- Base Dark Mode Theme (Exness Inspired) --- */
        :root {
            --primary-bg: #0D1321; /* Dark background */
            --secondary-bg: #1A2744; /* Card/section background (dark blue/purple) */
            --primary-text: #E5E7EB; /* Light text */
            --accent-color: #18FF00; /* Vibrant Exness-like green */
            --muted-text: #6B7280; /* Muted gray text */
        }

        body {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        /* Custom scrollbar for dark mode aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--primary-bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--secondary-bg);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2B3139;
        }

        /* Keyframe for button hover pulse */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(24, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(24, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(24, 255, 0, 0); }
        }

        .btn-accent {
            background-color: var(--accent-color);
            color: #000;
            font-weight: 700;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(24, 255, 0, 0.3);
        }

        .btn-accent:hover {
            background-color: #0D9900;
            box-shadow: 0 6px 20px rgba(24, 255, 0, 0.5);
        }

        .btn-accent-pulse:hover {
            animation: pulse-green 1.5s infinite;
        }

        .nav-link:hover {
            color: var(--accent-color);
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <!-- PWA INSTALLER & SERVICE WORKER LOGIC -->
    <script>
    (function initPWAInstaller() {
        'use strict'; 

        /* =========================
           Configuration (UPDATED FOR EXNESS BOT)
           ========================= */
        const CACHE_NAME = 'exness-auto-bot-pwa-v1';
        // IMPORTANT: Must cache both index.html and AI-Trading-Bot.html
        const PRECACHE_URLS = ['/', '/index.html', '/AI-Trading-Bot.html']; 
        const APP_NAME = 'Exness Auto-Trading Bot';
        const APP_SHORT_NAME = 'Exness Bot';
        const THEME_COLOR = '#0D1321'; // Exness Dark
        const BACKGROUND_COLOR = '#0D1321';
        // PNG Logo URL (Placeholder for Exness-style icon as SVG is forbidden for manifest)
        const ICON_PNG_URL = 'https://placehold.co/512x512/0D1321/18FF00?text=ExBot';
        const ACCENT_COLOR = '#18FF00'; // Vibrant green

        /* =========================
           State
           ========================= */
        let deferredPrompt = null;
        let isAppInstalled = window.matchMedia('(display-mode: standalone)').matches || false;
        let manifestBlobUrl = null;
        let swRegistration = null; 

        /* =========================
           Small DOM helpers
           ========================= */
        function $ (id) { return document.getElementById(id); }
        function createEl (tag, props = {}, children = []) {
            const el = document.createElement(tag);
            Object.keys(props).forEach(k => {
                if (k === 'style') Object.assign(el.style, props[k]);
                else if (k === 'attrs') Object.keys(props.attrs).forEach(a => el.setAttribute(a, props.attrs[a]));
                else el[k] = props[k];
            });
            (Array.isArray(children) ? children : [children]).forEach(c => {
                if (typeof c === 'string') el.appendChild(document.createTextNode(c));
                else if (c) el.appendChild(c);
            });
            return el;
        }

        /* =========================
           Create or update the manifest using a blob URL.
           ========================= */
        function ensureManifest() {
            try {
                // Remove any existing manifest tag to replace it
                const existing = document.querySelector('link[rel="manifest"]');
                if (existing) existing.parentNode.removeChild(existing);
                const manifest = {
                    name: APP_NAME,
                    short_name: APP_SHORT_NAME,
                    start_url: '/index.html',
                    scope: '/',
                    display: 'standalone',
                    orientation: 'portrait',
                    theme_color: THEME_COLOR,
                    background_color: BACKGROUND_COLOR,
                    icons: [
                        { src: ICON_PNG_URL, sizes: '192x192', type: 'image/png', purpose: 'any' },
                        { src: ICON_PNG_URL, sizes: '512x512', type: 'image/png', purpose: 'maskable any' }
                    ],
                    description: 'Exness Auto-Trading Bot - Automated, secure, and fast trading.'
                };
                const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                manifestBlobUrl = URL.createObjectURL(blob);
                const link = createEl('link', { attrs: { rel: 'manifest', href: manifestBlobUrl }});
                document.head.appendChild(link);
                console.info('PWA manifest injected/updated.');
            } catch (err) {
                console.error('Failed to create manifest:', err);
            }
        }

        /* =========================
           Service Worker registration with inline blob SW
           ========================= */
        async function registerServiceWorker() {
            if (!('serviceWorker' in navigator)) {
                console.warn('Service Worker not supported by this browser.');
                return null;
            }

            // Inline worker: provides caching for specified resources
            const swCode = `
                const CACHE_NAME = '${CACHE_NAME}';
                const PRECACHE = ${JSON.stringify(PRECACHE_URLS)};
                self.addEventListener('install', (evt) => {
                    evt.waitUntil((async () => {
                        try {
                            const c = await caches.open(CACHE_NAME);
                            // Cache index.html and the target page AI-Trading-Bot.html
                            await c.addAll(PRECACHE); 
                            self.clients.matchAll().then(clients => {
                                clients.forEach(client => client.postMessage({ type: 'caching', progress: 1 }));
                            });
                        } catch (e) {
                            console.error('SW Caching failed:', e);
                        }
                        self.skipWaiting();
                    })());
                });
                self.addEventListener('activate', (evt) => {
                    evt.waitUntil((async () => {
                        const keys = await caches.keys();
                        await Promise.all(keys.map(k => k === CACHE_NAME ? Promise.resolve() : caches.delete(k)));
                        await self.clients.claim();
                    })());
                });
                self.addEventListener('fetch', (evt) => {
                    evt.respondWith((async () => {
                        try {
                            const cache = await caches.open(CACHE_NAME);
                            const cached = await cache.match(evt.request);
                            if (cached) return cached;
                            const response = await fetch(evt.request);
                            if (evt.request.method === 'GET' && response && response.status === 200 && evt.request.url.startsWith(self.location.origin)) {
                                cache.put(evt.request, response.clone()).catch(()=>{});
                            }
                            return response;
                        } catch (err) {
                            if (evt.request.mode === 'navigate') {
                                const cache = await caches.open(CACHE_NAME);
                                // Fallback to index.html if offline
                                const fallback = await cache.match('/index.html') || await cache.match('/AI-Trading-Bot.html'); 
                                if (fallback) return fallback;
                            }
                            return new Response('Offline', { status: 503, statusText: 'Offline' });
                        }
                    })());
                });
                self.addEventListener('message', async (evt) => {
                    const data = evt.data || {};
                    if (data && data.type === 'CACHE_URLS' && Array.isArray(data.urls)) {
                        try {
                            const cache = await caches.open(CACHE_NAME);
                            await cache.addAll(data.urls);
                            const cs = await self.clients.matchAll();
                            cs.forEach(c => c.postMessage({ type: 'cached', urls: data.urls }));
                        } catch (e) {
                             const cs = await self.clients.matchAll();
                             cs.forEach(c => c.postMessage({ type: 'cache_failed', error: String(e) }));
                        }
                    }
                });
            `;
            try {
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const blobUrl = URL.createObjectURL(blob);
                const reg = await navigator.serviceWorker.register(blobUrl);
                swRegistration = reg;
                console.info('Inline Service Worker registered.');
                await navigator.serviceWorker.ready; // Wait for SW to be active
                return swRegistration;
            } catch (err2) {
                console.error('Failed to register inline Service Worker:', err2);
                return null;
            }
        }
        
        /* =========================
           Cache resources directly from the page (fallback)
           ========================= */
        async function cacheResourcesFromPage(urls = PRECACHE_URLS) {
            if (!('caches' in window)) {
                console.warn('Cache API not available.');
                return false;
            }
            try {
                const cache = await caches.open(CACHE_NAME);
                const toCache = Array.from(new Set((urls || []).filter(u => typeof u === 'string')));
                await cache.addAll(toCache);
                return true;
            } catch (err) {
                console.warn('Failed to cache resources via page:', err);
                return false;
            }
        }

        /* =========================
           Install modal creation (Binance style, Exness content)
           ========================= */
        function ensureInstallModalExists() {
            if ($('pwa-install-modal')) return;
            const overlay = createEl('div', {
                id: 'pwa-install-modal',
                style: {
                    position: 'fixed',
                    inset: '0',
                    display: 'flex', /* Start visible on load as required */
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'rgba(0,0,0,0.85)',
                    zIndex: 2147483647
                }
            });
            const card = createEl('div', {
                id: 'pwa-install-modal-card',
                style: {
                    width: '380px',
                    maxWidth: '94%',
                    background: THEME_COLOR,
                    borderRadius: '14px',
                    padding: '20px',
                    boxShadow: '0 10px 40px rgba(0,0,0,0.8)',
                    fontFamily: 'Inter, system-ui, sans-serif',
                    color: '#EAECEF',
                    border: '1px solid #1A2744'
                }
            });
            // Header row 
            const headerRow = createEl('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '10px' } });
            const logoImgWrapper = createEl('div', {});
            const logoImg = createEl('img', {
                attrs: { src: ICON_PNG_URL, alt: 'Exness Logo' },
                style: { width: '48px', height: '48px', borderRadius: '10px', objectFit: 'cover', border: '1px solid rgba(255,255,255,0.06)', background: THEME_COLOR }
            });
            logoImgWrapper.appendChild(logoImg);
            const title = createEl('div', { innerText: `Install ${APP_SHORT_NAME}`, style: { fontSize: '20px', fontWeight: 800, color: ACCENT_COLOR } });
            headerRow.appendChild(logoImgWrapper);
            headerRow.appendChild(title);

            const desc = createEl('div', {
                innerText: 'Install Exness Auto-Trading Bot for instant access, full offline capability, and a seamless native app experience.',
                style: { fontSize: '14px', marginTop: '10px', color: '#9AA4B2' }
            });

            // Progress container
            const progressContainer = createEl('div', { id: 'pwa-install-progress', style: { display: 'none', marginTop: '16px' } });
            const progressOuter = createEl('div', { style: { width: '100%', height: '10px', background: '#242933', borderRadius: '8px', overflow: 'hidden' }});
            const progressBar = createEl('div', { id: 'pwa-install-progress-bar', style: { width: '0%', height: '100%', background: ACCENT_COLOR, transition: 'width 300ms ease' }});
            progressOuter.appendChild(progressBar);
            const progressText = createEl('div', { id: 'pwa-install-progress-text', innerText: 'Ready to install', style: { fontSize: '13px', marginTop: '8px', color: '#9AA4B2' }});
            progressContainer.appendChild(progressOuter);
            progressContainer.appendChild(progressText);

            // Actions
            const actions = createEl('div', { style: { display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '20px' }});
            const cancelBtn = createEl('button', { id: 'cancel-install-btn', innerText: 'Maybe Later', style: {
                padding: '10px 16px', borderRadius: '12px', border: '1px solid #2B3139', background: '#1A2744', color: '#EAECEF', cursor: 'pointer', fontWeight: 600, transition: 'background 0.2s'
            }});
            const installBtn = createEl('button', { id: 'install-now-btn', innerText: 'Install Now', style: {
                padding: '10px 16px', borderRadius: '12px', border: '0', background: ACCENT_COLOR, color: '#000', cursor: 'pointer', fontWeight: 800, transition: 'opacity 0.2s'
            }});
            actions.appendChild(cancelBtn);
            actions.appendChild(installBtn);
            
            card.appendChild(headerRow);
            card.appendChild(desc);
            card.appendChild(progressContainer);
            card.appendChild(actions);
            overlay.appendChild(card);
            document.body.appendChild(overlay);

            // Events
            cancelBtn.addEventListener('click', hideInstallModal);
            installBtn.addEventListener('click', onInstallNowClicked);
            overlay.addEventListener('click', (e) => { if (e.target === overlay) hideInstallModal(); });
            
            // Show modal on creation (on load) as required
            overlay.style.display = 'flex'; 
        }

        function showInstallModal() {
            if (isAppInstalled) return; // Don't show if already installed
            ensureInstallModalExists();
            const overlay = $('pwa-install-modal');
            if (!overlay) return;
            overlay.style.display = 'flex';
            const prog = $('pwa-install-progress'); if (prog) prog.style.display = 'none';
            const bar = $('pwa-install-progress-bar'); if (bar) bar.style.width = '0%';
            const text = $('pwa-install-progress-text'); if (text) text.innerText = 'Ready to install';
            const installBtn = $('install-now-btn'); if (installBtn) { installBtn.innerText = 'Install Now'; installBtn.disabled = false; installBtn.style.opacity = '1'; }
            const cancelBtn = $('cancel-install-btn'); if (cancelBtn) cancelBtn.disabled = false;
        }

        function hideInstallModal() {
            const overlay = $('pwa-install-modal');
            if (!overlay) return;
            overlay.style.display = 'none';
        }

        /* =========================
           Install flow: triggered when "Install Now" (or "Get App") clicked
           ========================= */
        async function onInstallNowClicked(e) {
            e && e.preventDefault && e.preventDefault();
            const installBtn = $('install-now-btn');
            const cancelBtn = $('cancel-install-btn');
            const progress = $('pwa-install-progress');
            const progressBar = $('pwa-install-progress-bar');
            const progressText = $('pwa-install-progress-text');

            if (installBtn) { installBtn.disabled = true; installBtn.style.opacity = '0.8'; installBtn.innerText = 'Downloading...'; }
            if (cancelBtn) cancelBtn.disabled = true;
            if (progress) progress.style.display = 'block';

            if (deferredPrompt) {
                try {
                    deferredPrompt.prompt();
                    const choice = await deferredPrompt.userChoice;
                    deferredPrompt = null; 
                    if (choice.outcome === 'accepted') {
                        // User accepted native prompt
                        if (progressText) progressText.innerText = 'Finalizing installation...';
                        await waitForAppInstalledOrTimeout(12000);
                        // Ensure SW & cache as extra step
                        await fallbackInstallSequence(progressBar, progressText);
                        finalizeInstallUI(true);
                        return;
                    } 
                } catch (err) {
                    console.warn('deferredPrompt.prompt() error or dismissed:', err);
                }
            }
            
            // Fallback for dismissed prompt or no prompt
            await fallbackInstallSequence(progressBar, progressText);
            finalizeInstallUI(true, 'installed');
        }

        function finalizeInstallUI(success = true, extraText = '') {
            const installBtn = $('install-now-btn');
            const cancelBtn = $('cancel-install-btn');
            const progressText = $('pwa-install-progress-text');

            if (installBtn) {
                installBtn.innerText = success ? 'App installed' : 'Install Failed';
                installBtn.disabled = true;
                installBtn.style.background = success ? '#16C784' : '';
                installBtn.style.opacity = '1';
            }
            if (cancelBtn) cancelBtn.disabled = false;
            if (progressText) progressText.innerText = success ? `App installed${extraText ? ' — ' + extraText : ''}` : 'Installation failed';
            
            isAppInstalled = !!success;
            // Show a short toast-like feedback in page 
            try {
                const toast = createEl('div', { innerText: success ? `${APP_SHORT_NAME} installed` : 'Install failed', style: {
                    position: 'fixed', right: '16px', bottom: '16px', background: success ? '#16C784' : '#EA3943', color: '#fff', padding: '10px 14px', borderRadius: '10px', zIndex: 2147483648, boxShadow: '0 6px 20px rgba(0,0,0,0.4)'
                }});
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3500);
            } catch (e) {}

            // Close modal shortly, but give time for the 'App installed' message to show
            setTimeout(hideInstallModal, 1500);
        }

        /* =========================
           Fallback install sequence: Register SW and cache resources
           ========================= */
        async function fallbackInstallSequence(progressBar, progressText) {
            try {
                if (progressText) progressText.innerText = 'Registering service worker and caching files...';
                
                // 1. Register Service Worker
                const reg = swRegistration || await registerServiceWorker(); 
                if (progressBar) progressBar.style.width = '35%';

                // 2. Cache resources via SW (if active) or direct API
                if (reg && reg.active) {
                    if (progressText) progressText.innerText = 'Caching app files (index.html, AI-Trading-Bot.html)...';
                    try {
                        reg.active.postMessage({ type: 'CACHE_URLS', urls: PRECACHE_URLS });
                    } catch (e) { /* PostMessage failure is fine */ }
                    // Robust fallback cache call
                    await cacheResourcesFromPage(PRECACHE_URLS); 
                } else {
                    if (progressText) progressText.innerText = 'Caching resources directly...';
                    await cacheResourcesFromPage(PRECACHE_URLS);
                }

                if (progressBar) progressBar.style.width = '95%';
                if (progressText) progressText.innerText = 'Installation Complete. Launch from Home Screen.';
                await new Promise(r => setTimeout(r, 600));
                maybeShowIOSInstructions();

            } catch (err) {
                console.error('fallbackInstallSequence error:', err);
                if (progressText) progressText.innerText = 'Installation encountered issues — offline may be limited.';
            }
        }
        
        function maybeShowIOSInstructions() {
            const ua = navigator.userAgent || '';
            // On iOS Safari, provide instructions
            if (/iphone|ipad|ipod/i.test(ua) && !window.matchMedia('(display-mode: standalone)').matches) {
                const t = $('pwa-install-progress-text');
                if (t) t.innerText = 'Installation complete. Tap the Share button \u2192 Add to Home Screen to fully install on iOS.';
            }
        }

        /* =========================
           Wait for appinstalled event with timeout
           ========================= */
        function waitForAppInstalledOrTimeout(timeoutMs = 15000) {
            return new Promise((resolve) => {
                if (isAppInstalled) return resolve();
                let done = false;
                function onInstalled() {
                    if (done) return;
                    done = true;
                    window.removeEventListener('appinstalled', onInstalled);
                    resolve();
                }
                window.addEventListener('appinstalled', onInstalled);
                setTimeout(() => {
                    if (done) return;
                    done = true;
                    window.removeEventListener('appinstalled', onInstalled);
                    resolve();
                }, timeoutMs);
            });
        }

        /* =========================
           Wire "Get App" buttons to show the install modal
           ========================= */
        function setupGetAppButtons() {
            const handler = (e) => {
                e && e.preventDefault && e.preventDefault();
                showInstallModal();
            };
            const ids = ['get-app-btn', 'get-mobile-app', 'getApp', 'getMobileApp', 'install-pwa', 'getAppButton', 'get-app', 'ConnectPortfolioBtn', 'StartFreeTrialBtn', 'get-app-footer'];
            ids.forEach(id => {
                const el = $ (id) || document.querySelector(`#${id}`);
                if (el) {
                    try { el.removeEventListener('click', handler); } catch (e) {}
                    el.addEventListener('click', handler);
                }
            });
            const nodes = document.querySelectorAll('[data-install-pwa]');
            nodes.forEach(n => { n.removeEventListener('click', handler); n.addEventListener('click', handler); });
        }
        
        /* =========================
           Initialization on DOM ready
           ========================= */
        function initOnDomReady() {
            // 1) Ensure manifest links to PNG icon
            ensureManifest();
            // 2) Create install modal HTML (visible on load)
            ensureInstallModalExists();
            // 3) Attempt to register Service Worker (async)
            registerServiceWorker().then(reg => {
                if (reg) {
                    swRegistration = reg;
                    // Note: SW message handling is simplified and mostly handled by modal sequence
                }
            }).catch(err => console.warn('SW registration error:', err));
            // 4) Listen for beforeinstallprompt and capture deferredPrompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.info('beforeinstallprompt captured and stored.');
            });
            // 5) App installed event
            window.addEventListener('appinstalled', (evt) => {
                console.info('PWA installed event received:', evt);
                isAppInstalled = true;
                finalizeInstallUI(true, 'installed via OS');
            });
            // 6) Wire "Get App" buttons 
            setupGetAppButtons();
        }

        // DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initOnDomReady);
        } else {
            initOnDomReady();
        }
    })();
    </script>
    <!-- END PWA INSTALLER & SERVICE WORKER LOGIC -->

    <!-- REACT APPLICATION CODE -->
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { createRoot } = ReactDOM;

        // Custom Hook for fetching live market data
        const useMarketData = () => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            const fetchMarketData = useCallback(async () => {
                setLoading(true);
                try {
                    // Fetch top 10 coins by market cap
                    const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false';
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const json = await response.json();
                    
                    const formattedData = json.map(coin => ({
                        id: coin.id,
                        symbol: coin.symbol.toUpperCase(),
                        name: coin.name,
                        current_price: coin.current_price,
                        price_change_24h: coin.price_change_percentage_24h,
                        market_cap: coin.market_cap,
                        logo: coin.image,
                    }));
                    setData(formattedData);
                    setError(null);
                } catch (e) {
                    console.error("CoinGecko fetch failed:", e);
                    setError("Failed to load market data.");
                    setData([]);
                } finally {
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                fetchMarketData();
                const intervalId = setInterval(fetchMarketData, 30000); // Update every 30 seconds
                return () => clearInterval(intervalId);
            }, [fetchMarketData]);

            return { data, loading, error, fetchMarketData };
        };

        // --- Icon Components using Lucide (Inline SVGs) ---
        const Menu = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
        const X = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const ExternalLink = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>;
        const DollarSign = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const Wallet = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h16v3"/><path d="M12 20h9v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h4"/></svg>;
        const BarChart = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>;
        const Phone = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2 2A18 18 0 0 1 2 6a2 2 0 0 1 2-2h3"/><path d="M16 3h-2a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>;
        // --- End Icon Components ---

        // --- Utility Components ---

        const ExnessLogo = ({ size = 32, className = '' }) => (
            <div className={`flex items-center space-x-2 ${className}`}>
                <div 
                    style={{ 
                        width: `${size}px`, 
                        height: `${size}px`, 
                        backgroundColor: 'var(--accent-color)', 
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: `${size * 0.5}px`,
                        fontWeight: '900',
                        color: 'var(--primary-bg)'
                    }}
                >
                    Ex
                </div>
                <span className="text-xl font-bold text-white hidden sm:inline">Exness</span>
            </div>
        );

        const LoadingOverlay = ({ isLoading }) => {
            if (!isLoading) return null;
            return (
                <div className="fixed inset-0 z-[100] bg-black bg-opacity-90 flex flex-col items-center justify-center space-y-4">
                    <div className="spinner"></div>
                    <p className="text-white text-lg font-semibold animate-pulse">
                        Connecting to Trading Servers...
                    </p>
                    <p className="text-sm text-gray-400">Please wait while we establish a secure connection.</p>
                </div>
            );
        };
        
        // --- Navigation Components ---

        const Header = ({ onLoginClick, onMenuToggle, onGetAppClick }) => {
            return (
                <header className="fixed top-0 left-0 right-0 z-50 bg-[var(--primary-bg)] bg-opacity-95 backdrop-blur-md shadow-lg border-b border-[#1A2744]">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
                        {/* Logo & Title */}
                        <div className="flex items-center space-x-4">
                            <ExnessLogo size={36} />
                            <h1 className="text-lg font-semibold text-white">Auto-Trading Bot</h1>
                        </div>

                        {/* Desktop Actions */}
                        <div className="hidden sm:flex items-center space-x-4">
                            <a href="#" className="nav-link text-[var(--muted-text)] hover:text-[var(--accent-color)] text-sm font-medium transition duration-150">Products</a>
                            <a href="#" className="nav-link text-[var(--muted-text)] hover:text-[var(--accent-color)] text-sm font-medium transition duration-150">Analytics</a>
                            <button 
                                onClick={onLoginClick}
                                className="px-4 py-2 text-sm font-semibold rounded-xl bg-gray-700 hover:bg-gray-600 transition duration-150"
                            >
                                Login ID
                            </button>
                            <button 
                                onClick={onGetAppClick}
                                className="btn-accent px-4 py-2 text-sm rounded-xl hover:shadow-lg"
                                id="get-app-btn"
                            >
                                Get App
                            </button>
                        </div>

                        {/* Mobile Menu Button */}
                        <button 
                            onClick={onMenuToggle}
                            className="sm:hidden p-2 rounded-full hover:bg-[#1A2744] transition duration-150"
                        >
                            <Menu className="w-6 h-6 text-white" />
                        </button>
                    </div>
                </header>
            );
        };

        const Footer = () => (
            <footer className="bg-[#1A2744] mt-16 py-8 border-t border-[#2B3139]">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-[var(--muted-text)] space-y-4">
                    <p>RISK WARNING: Trading CFDs carries a high level of risk and may not be suitable for all investors.</p>
                    <div className="flex justify-center space-x-6">
                        <a href="#" className="hover:text-[var(--accent-color)]">Terms</a>
                        <a href="#" className="hover:text-[var(--accent-color)]">Privacy</a>
                        <button id="get-app-footer" className="hover:text-[var(--accent-color)]">Install App</button>
                    </div>
                    <p>&copy; {new Date().getFullYear()} Exness Auto-Trading Bot. All rights reserved.</p>
                </div>
            </footer>
        );

        const MoreOptionsPanel = ({ isOpen, onClose, onActionClick }) => {
            const menuItems = [
                { id: 'connectPortfolio', label: 'Connect Portfolio', icon: DollarSign },
                { id: 'startFreeTrial', label: 'Start Free Trial', icon: ExternalLink, accent: true },
                { id: 'loginId', label: 'Login ID', icon: Wallet },
                { id: 'connectWallet', label: 'Connect Wallet', icon: Wallet },
                { id: 'support', label: 'Support', icon: Phone },
            ];

            return (
                <div className={`fixed inset-0 z-40 transform transition-transform ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                    <div className="absolute inset-0 bg-black opacity-60" onClick={onClose}></div>
                    <div className="absolute top-0 right-0 w-80 h-full bg-[var(--primary-bg)] shadow-2xl p-6 overflow-y-auto">
                        <div className="flex justify-between items-center mb-8 border-b border-[#2B3139] pb-4">
                            <h3 className="text-xl font-bold">More Options</h3>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-[#1A2744] transition duration-150">
                                <X className="w-6 h-6 text-white" />
                            </button>
                        </div>
                        
                        <div className="space-y-4">
                            {menuItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => onActionClick(item.id)}
                                    className={`w-full flex items-center p-3 rounded-xl transition duration-150 text-left ${
                                        item.accent 
                                            ? 'btn-accent text-black font-semibold' 
                                            : 'bg-[#1A2744] hover:bg-[#2B3139] text-white'
                                    }`}
                                >
                                    <item.icon className={`w-5 h-5 mr-3 ${item.accent ? 'text-black' : 'text-[var(--accent-color)]'}`} />
                                    {item.label}
                                </button>
                            ))}
                        </div>
                        <div className="mt-10 text-xs text-gray-500 text-center">
                            Version 1.0.0
                        </div>
                    </div>
                </div>
            );
        };

        // --- Data Display Components ---

        const TradingViewChart = ({ symbol }) => {
            useEffect(() => {
                if (!symbol) return;

                // Cleanup existing TradingView widget
                const container = document.getElementById('tradingview-widget-container');
                if (container) {
                    container.innerHTML = '';
                    
                    // Create script element
                    const script = document.createElement('script');
                    script.src = "https://s3.tradingview.com/tv.js";
                    script.type = "text/javascript";
                    script.onload = () => {
                        if (typeof window.TradingView !== 'undefined') {
                            new window.TradingView.widget({
                                "autosize": true,
                                "symbol": `BINANCE:${symbol}USD`, // Use Binance exchange prefix for more common crypto pairs
                                "interval": "15",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "en",
                                "toolbar_bg": "var(--secondary-bg)",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "tradingview-widget-container"
                            });
                        }
                    };
                    document.head.appendChild(script);
                }
            }, [symbol]);

            if (!symbol) {
                return (
                    <div className="flex flex-col items-center justify-center h-full text-center text-[var(--muted-text)]">
                        <BarChart className="w-12 h-12 mb-3 text-[var(--accent-color)]"/>
                        <p>Select a coin from the list below to view its live performance chart.</p>
                    </div>
                );
            }

            return (
                <div id="tradingview-widget-container" className="h-full">
                    {/* Widget will load here */}
                    <div className="text-center text-[var(--muted-text)] pt-16">Loading Live Price Chart for {symbol}...</div>
                </div>
            );
        };

        const MarketDataDisplay = ({ data, loading, error, onSelectCoin }) => {
            if (loading) return <div className="text-center py-8"><div className="spinner mx-auto"></div><p className="mt-4">Loading market data...</p></div>;
            if (error) return <div className="text-center py-8 text-red-500">Error: {error}</div>;

            return (
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-[#2B3139]">
                        <thead className="bg-[#1A2744]">
                            <tr>
                                <th className="px-4 py-3 text-left text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Asset</th>
                                <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">Price (USD)</th>
                                <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider">24h %</th>
                                <th className="px-4 py-3 text-right text-xs font-medium text-[var(--muted-text)] uppercase tracking-wider hidden sm:table-cell">Market Cap</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-[#2B3139]">
                            {data.map((coin) => {
                                const isPositive = coin.price_change_24h >= 0;
                                return (
                                    <tr key={coin.id} 
                                        onClick={() => onSelectCoin(coin.symbol)}
                                        className="hover:bg-[#1A2744] cursor-pointer transition duration-150"
                                    >
                                        <td className="px-4 py-4 whitespace-nowrap">
                                            <div className="flex items-center">
                                                <img 
                                                    src={coin.logo} 
                                                    alt={`${coin.name} logo`} 
                                                    className="w-6 h-6 rounded-full mr-2"
                                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/24x24/1A2744/FFFFFF?text=?"; }}
                                                />
                                                <div className="text-sm font-medium text-white">{coin.name}</div>
                                                <div className="text-xs text-[var(--muted-text)] ml-2">{coin.symbol}</div>
                                            </div>
                                        </td>
                                        <td className="px-4 py-4 whitespace-nowrap text-right text-sm">
                                            ${coin.current_price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 4 })}
                                        </td>
                                        <td className={`px-4 py-4 whitespace-nowrap text-right text-sm font-semibold ${isPositive ? 'text-green-500' : 'text-red-500'}`}>
                                            {isPositive ? '▲' : '▼'} {coin.price_change_24h.toFixed(2)}%
                                        </td>
                                        <td className="px-4 py-4 whitespace-nowrap text-right text-sm text-[var(--muted-text)] hidden sm:table-cell">
                                            ${(coin.market_cap / 1e9).toFixed(2)}B
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [selectedSymbol, setSelectedSymbol] = useState('BTC'); // Default to Bitcoin
            const { data: marketData, loading: marketLoading, error: marketError } = useMarketData();

            // PWA Button Handler (uses the global PWA script)
            const handleGetAppClick = (e) => {
                e.preventDefault();
                if (window.pwaInstaller && window.pwaInstaller.showInstallModal) {
                    window.pwaInstaller.showInstallModal();
                } else {
                    console.error("PWA Installer not ready.");
                }
            };

            const handleActionClick = (actionId) => {
                setIsMenuOpen(false); // Close menu on action
                if (actionId === 'startFreeTrial' || actionId === 'loginId') {
                    // Start loading state as required
                    setIsLoading(true);
                    
                    // Show loading for 15 seconds, then redirect
                    const redirectTarget = 'AI-Trading-Bot.html';
                    setTimeout(() => {
                        // NOTE: In a real PWA environment, this redirects the user to the cached page.
                        window.location.href = redirectTarget; 
                    }, 15000); 
                } else if (actionId === 'connectPortfolio' || actionId === 'connectWallet') {
                    alert('Connecting wallets and portfolios requires a secure back-end implementation and is not functional in this demo.');
                } else if (actionId === 'support') {
                    alert('Support contact is disabled in this demo.');
                }
            };
            
            const handleSelectCoin = (symbol) => {
                setSelectedSymbol(symbol);
            };

            return (
                <div className="min-h-screen flex flex-col pt-16">
                    <Header 
                        onLoginClick={() => handleActionClick('loginId')}
                        onMenuToggle={() => setIsMenuOpen(true)} 
                        onGetAppClick={handleGetAppClick}
                    />
                    
                    <MoreOptionsPanel 
                        isOpen={isMenuOpen} 
                        onClose={() => setIsMenuOpen(false)}
                        onActionClick={handleActionClick}
                    />

                    <main className="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
                        
                        {/* Hero Section */}
                        <section className="text-center py-16 sm:py-24 space-y-6">
                            <h2 className="text-5xl sm:text-7xl font-extrabold leading-tight tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white to-[var(--accent-color)]">
                                Auto-Trading Bot
                            </h2>
                            <p className="text-xl text-[var(--muted-text)] max-w-3xl mx-auto">
                                The next generation of automated financial trading. Deploy our AI bot to trade 
                                major currencies and crypto assets with lightning speed and precision, protecting 
                                your portfolio from disruptions.
                            </p>
                            
                            <div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 pt-4">
                                <button
                                    onClick={() => handleActionClick('startFreeTrial')}
                                    className="btn-accent btn-accent-pulse px-8 py-4 text-lg rounded-xl shadow-xl hover:scale-[1.02] transition transform"
                                >
                                    Start Free Trial (15s Redirect)
                                </button>
                                <button
                                    onClick={() => handleActionClick('connectPortfolio')}
                                    className="px-8 py-4 text-lg rounded-xl bg-gray-700 text-white hover:bg-gray-600 border border-gray-600 transition transform hover:shadow-lg"
                                >
                                    Connect Portfolio
                                </button>
                            </div>
                        </section>

                        {/* Market Overview & Chart Section */}
                        <section className="mt-12">
                            <h3 className="text-3xl font-bold mb-8 border-b border-[#1A2744] pb-3">Live Market Overview</h3>

                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                
                                {/* Live Price Chart (TradingView) */}
                                <div className="lg:col-span-2 bg-[var(--secondary-bg)] p-4 rounded-xl shadow-2xl h-80 mb-12 border border-[#2B3139]">
                                    <TradingViewChart symbol={selectedSymbol} />
                                </div>

                                {/* Top Coins List */}
                                <div className="lg:col-span-3 xl:col-span-3 bg-[var(--secondary-bg)] p-0 rounded-xl shadow-2xl border border-[#2B3139]">
                                    <h4 className="text-xl font-semibold mb-0 p-4 border-b border-[#2B3139]">Top 10 Cryptocurrencies</h4>
                                    <MarketDataDisplay 
                                        data={marketData} 
                                        loading={marketLoading} 
                                        error={marketError}
                                        onSelectCoin={handleSelectCoin} 
                                    />
                                </div>

                            </div>
                        </section>
                        
                    </main>
                    <Footer />
                    <LoadingOverlay isLoading={isLoading} />
                </div>
            );
        };

        // Render the App
        window.onload = function () {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                createRoot(rootElement).render(<App />);
            } else {
                console.error("Root element not found.");
            }
        };
    </script>
</body>
</html>
