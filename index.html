<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exness Auto-Trading Bot</title>
    <!-- Exness PWA Manifest will be injected via JS blob URL -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg width='128' height='128' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='128' height='128' fill='%230B0E11'/%3E%3C/svg%3E">
    <!-- Tailwind CSS and Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Tailwind theme extension for Exness colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'exness-yellow': '#FFDE02',
                        'exness-dark': '#0B0E11',
                        'exness-light': '#2B3139',
                        'exness-text': '#9AA4B2',
                        'success': '#00D4AA',
                        'error': '#F6465D'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    },
                    backgroundImage: {
                        'hero-gradient': 'linear-gradient(135deg, #FFDE02 0%, #EAC902 100%)',
                        'card-gradient': 'linear-gradient(135deg, rgba(255, 222, 2, 0.1) 0%, rgba(255, 222, 2, 0.05) 100%)'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0B0E11; /* Dark background */
            color: #FFFFFF;
        }
        .glass-effect {
            background: rgba(30, 35, 41, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 222, 2, 0.1);
        }
        .hover-glow:hover {
            box-shadow: 0 0 20px rgba(255, 222, 2, 0.3);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        .pwa-install-banner {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .trading-card {
            background: linear-gradient(135deg, rgba(30, 35, 41, 0.9) 0%, rgba(43, 49, 57, 0.5) 100%);
            border: 1px solid rgba(255, 222, 2, 0.2);
        }
        .price-up { color: #00D4AA; }
        .price-down { color: #F6465D; }
        .chat-widget { position: fixed; bottom: 20px; left: 20px; z-index: 999; display: none; }
    </style>
</head>
<body class="bg-exness-dark">

    <!-- PWA Install Banner (hidden until triggered) -->
    <div id="pwa-install-banner" class="pwa-install-banner glass-effect rounded-lg p-4">
        <div class="flex items-center justify-between">
            <div>
                <h4 class="font-semibold text-white">Install Exness Bot</h4>
                <p class="text-sm text-exness-text">Add to home screen for quick access</p>
            </div>
            <div class="flex gap-2">
                <button id="install-pwa" class="bg-exness-yellow text-black px-3 py-1 rounded-md text-sm font-medium">Install</button>
                <button id="dismiss-banner" class="text-exness-text text-sm">✕</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="fixed top-0 w-full z-50 glass-effect">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-3">
                    <!-- Exness logo (yellow circle placeholder) -->
                    <div class="w-8 h-8 bg-exness-yellow rounded-sm flex items-center justify-center">
                        <!-- Replace this SVG with real Exness logo SVG/PNG -->
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 256 256" class="text-black">
                            <circle cx="128" cy="128" r="120" fill="#FFDE02"/>
                            <text x="128" y="158" text-anchor="middle" fill="#0B0E11" font-size="100" font-family="Inter">EX</text>
                        </svg>
                    </div>
                    <span class="text-xl font-bold">Exness Auto-Trading</span>
                </div>
                <!-- Desktop Navigation Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#" class="text-white hover:text-exness-yellow transition-colors">Home</a>
                    <a href="#" class="text-white hover:text-exness-yellow transition-colors">Features</a>
                    <a href="#" class="text-white hover:text-exness-yellow transition-colors">Market</a>
                    <a href="#" class="text-white hover:text-exness-yellow transition-colors">Support</a>
                </div>
                <!-- Auth Buttons -->
                <div class="flex items-center space-x-4">
                    <button id="connect-wallet" class="hidden md:block bg-transparent border border-exness-yellow text-exness-yellow px-4 py-2 rounded-md hover:bg-exness-yellow hover:text-black transition-all">Connect Wallet</button>
                    <button id="auth-button" class="bg-exness-yellow text-black px-4 py-2 rounded-md font-medium hover-glow">Login</button>
                    <!-- "More" Dropdown (mobile) -->
                    <div class="relative md:hidden">
                        <button id="more-options-btn" class="bg-exness-yellow text-black px-3 py-2 rounded-md font-medium hover-glow">More</button>
                        <div id="more-options-menu" class="absolute right-0 mt-2 w-48 bg-exness-dark border border-exness-light rounded-md shadow-lg hidden">
                            <button id="connect-portfolio-btn-mobile" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-exness-light">Connect Portfolio</button>
                            <button id="login-id-btn-mobile" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-exness-light">Login ID</button>
                            <button id="support-btn-mobile" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-exness-light">Support</button>
                            <button id="start-free-trial-btn-mobile" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-exness-light">Start Free Trial</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section (Landing Page) -->
    <section class="pt-24 pb-16 px-4">
        <div class="max-w-7xl mx-auto text-center">
            <div class="space-y-6">
                <h1 class="text-4xl md:text-6xl font-bold">
                    <span class="block">Automated.</span>
                    <span class="block">Secure.</span>
                    <span class="block text-exness-yellow">Rewarding.</span>
                </h1>
                <p class="text-xl md:text-2xl text-exness-text max-w-2xl mx-auto">
                    Exness Auto-Trading Bot – Trade crypto assets with AI-powered strategies.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mt-8">
                    <button id="get-app-btn" class="bg-hero-gradient text-black px-8 py-4 rounded-lg font-semibold text-lg hover-glow flex items-center space-x-2">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z"/>
                        </svg>
                        <span>Get Mobile App</span>
                    </button>
                    <button id="explore-web3" class="text-exness-yellow border border-exness-yellow px-8 py-4 rounded-lg font-semibold hover:bg-exness-yellow hover:text-black transition-all">
                        Learn More
                    </button>
                </div>
            </div>
            <!-- Hero Illustration (Placeholder) -->
            <div class="mt-16">
                <div class="max-w-4xl mx-auto glass-effect rounded-2xl p-8">
                    <img src="https://placehold.co/1200x600/0B0E11/FFDE02?text=Exness+Trading+Preview" alt="Exness Trading Interface" class="w-full h-auto rounded-xl"/>
                </div>
            </div>
        </div>
    </section>

    <!-- Market Overview Section -->
    <section id="market-overview" class="py-16 px-4 bg-exness-light">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-exness-dark">Market Overview</h2>
                <p class="text-lg text-exness-text max-w-2xl mx-auto">
                    Real-time crypto market data powered by CoinGecko API1011.
                </p>
            </div>
            <!-- Global Stats Cards -->
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <h3 class="text-lg font-semibold mb-2">Total Market Cap (USD)</h3>
                    <p id="total-market-cap" class="text-3xl font-bold">Loading...</p>
                </div>
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <h3 class="text-lg font-semibold mb-2">Active Cryptos</h3>
                    <p id="active-cryptos" class="text-3xl font-bold">Loading...</p>
                </div>
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <h3 class="text-lg font-semibold mb-2">Markets</h3>
                    <p id="market-count" class="text-3xl font-bold">Loading...</p>
                </div>
            </div>
            <!-- Top Coins -->
            <h3 class="text-2xl font-semibold mb-4 text-exness-dark text-center">Top Cryptocurrencies</h3>
            <div id="top-coins" class="grid md:grid-cols-3 gap-8">
                <!-- Will be populated by JS -->
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <p class="text-lg text-exness-text">Loading...</p>
                </div>
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <p class="text-lg text-exness-text">Loading...</p>
                </div>
                <div class="trading-card rounded-2xl p-6 hover-glow">
                    <p class="text-lg text-exness-text">Loading...</p>
                </div>
            </div>
            <!-- Live Chart via TradingView -->
            <div class="mt-12">
                <h3 class="text-2xl font-semibold mb-4 text-exness-dark text-center">Market Trend (BTC/USDT)</h3>
                <div id="tradingview-chart" class="tradingview-widget-container mx-auto">
                    <!-- TradingView widget will load here -->
                    <script src="https://s3.tradingview.com/tv.js"></script>
                    <script type="text/javascript">
                        new TradingView.widget({
                            "container_id": "tradingview-chart",
                            "width": "100%",
                            "height": 400,
                            "symbol": "COINBASE:BTCUSD",
                            "interval": "60",
                            "timezone": "Etc/UTC",
                            "theme": "dark",
                            "style": "1",
                            "locale": "en",
                            "toolbar_bg": "#0B0E11",
                            "enable_publishing": false,
                            "hide_top_toolbar": true,
                            "save_image": false,
                            "studies": ["MACD@tv-basicstudies"]
                        });
                    </script>
                </div>
            </div>
        </div>
    </section>

    <!-- More Options / Quick Actions Section -->
    <section class="py-16 px-4">
        <div class="max-w-7xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-8">Quick Actions</h2>
            <div class="flex flex-wrap justify-center gap-6">
                <button id="connect-portfolio-btn" class="bg-exness-yellow text-black px-6 py-3 rounded-md font-semibold hover-glow">
                    Connect Portfolio
                </button>
                <button id="login-id-btn" class="bg-exness-yellow text-black px-6 py-3 rounded-md font-semibold hover-glow">
                    Login ID
                </button>
                <button id="support-btn" class="bg-exness-yellow text-black px-6 py-3 rounded-md font-semibold hover-glow">
                    Support
                </button>
                <button id="start-free-trial-btn" class="bg-exness-yellow text-black px-6 py-3 rounded-md font-semibold hover-glow">
                    Start Free Trial
                </button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 px-4 bg-exness-dark">
        <div class="max-w-7xl mx-auto text-center text-exness-text">
            <div class="flex flex-wrap justify-center gap-6 mb-4">
                <a href="#" class="hover:text-exness-yellow">Privacy Policy</a>
                <a href="#" class="hover:text-exness-yellow">Terms of Use</a>
                <a href="#" class="hover:text-exness-yellow">Contact Us</a>
            </div>
            <p class="text-sm">&copy; 2025 Exness. All rights reserved.</p>
        </div>
    </footer>

    <!-- PWA Installer and Market Data Scripts -->
    <script>
    (function initPWAInstaller() {
  'use strict';
  // ========== Configuration ==========
  const CACHE_NAME = 'exness-auto-trading-pwa-v1';
  // Pre-cache index and AI-Trading-Bot pages for offline
  const PRECACHE_URLS = ['/', '/index.html', '/AI-Trading-Bot.html'];
  const APP_NAME = 'Exness Auto-Trading Bot';
  const APP_SHORT_NAME = 'Exness';
  const THEME_COLOR = '#0B0E11';
  const BACKGROUND_COLOR = '#0B0E11';
  // Exness App Icon (placeholder provided)
  const ICON_PNG_URL = 'https://placehold.co/512x512/00A389/ffffff?text=EX';
  // ========== State ==========
  let deferredPrompt = null, isAppInstalled = false, manifestBlobUrl = null, swRegistration = null;
  // ========== Helper Functions ==========
  function $ (id) { return document.getElementById(id); }
  function q (sel) { return document.querySelector(sel); }
  function createEl (tag, props = {}, children = []) {
    const el = document.createElement(tag);
    Object.keys(props).forEach(k => {
      if (k === 'style') Object.assign(el.style, props[k]);
      else if (k === 'attrs') Object.keys(props.attrs).forEach(a => el.setAttribute(a, props.attrs[a]));
      else el[k] = props[k];
    });
    (Array.isArray(children) ? children : [children]).forEach(c => {
      if (typeof c === 'string') el.appendChild(document.createTextNode(c));
      else if (c) el.appendChild(c);
    });
    return el;
  }
  // ========== Manifest Injection ==========
  function ensureManifest() {
    try {
      const existing = document.querySelector('link[rel="manifest"]');
      if (existing) existing.parentNode.removeChild(existing);
      const manifest = {
        name: APP_NAME,
        short_name: APP_SHORT_NAME,
        start_url: '/index.html',
        scope: '/',
        display: 'standalone',
        orientation: 'portrait',
        theme_color: THEME_COLOR,
        background_color: BACKGROUND_COLOR,
        icons: [
          { src: ICON_PNG_URL, sizes: '192x192', type: 'image/png', purpose: 'any' },
          { src: ICON_PNG_URL, sizes: '512x512', type: 'image/png', purpose: 'maskable any' }
        ],
        description: 'Exness Auto-Trading Bot – automated crypto trading'
      };
      const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
      manifestBlobUrl = URL.createObjectURL(blob);
      const link = createEl('link', { attrs: { rel: 'manifest', href: manifestBlobUrl }});
      document.head.appendChild(link);
      console.info('PWA manifest injected for Exness App.');
    } catch (err) {
      console.error('Manifest creation failed:', err);
    }
  }
  // ========== Service Worker Registration ==========
  async function registerServiceWorker() {
    if (!('serviceWorker' in navigator)) {
      console.warn('Service Worker not supported.');
      return null;
    }
    try {
      const reg = await navigator.serviceWorker.register('/sw.js');
      swRegistration = reg;
      console.info('Service Worker registered from /sw.js');
      await waitForServiceWorkerReady();
      return swRegistration;
    } catch (err) {
      console.warn('Register /sw.js failed, falling back to inline. Error:', err);
    }
    // Inline fallback SW code
    const swCode = `
      const CACHE_NAME = '${CACHE_NAME}';
      const PRECACHE = ${JSON.stringify(PRECACHE_URLS)};
      self.addEventListener('install', (evt) => {
        evt.waitUntil((async () => {
          try { const c = await caches.open(CACHE_NAME); await c.addAll(PRECACHE); } catch (e) {}
          self.skipWaiting();
        })());
      });
      self.addEventListener('activate', (evt) => {
        evt.waitUntil((async () => {
          const keys = await caches.keys();
          await Promise.all(keys.map(k => k === CACHE_NAME ? Promise.resolve() : caches.delete(k)));
          await self.clients.claim();
        })());
      });
      self.addEventListener('fetch', (evt) => {
        evt.respondWith((async () => {
          try {
            const cache = await caches.open(CACHE_NAME);
            const cached = await cache.match(evt.request);
            if (cached) return cached;
            const response = await fetch(evt.request);
            if (evt.request.method === 'GET' && response && response.status === 200 && evt.request.url.startsWith(self.location.origin)) {
              cache.put(evt.request, response.clone()).catch(()=>{});
            }
            return response;
          } catch (err) {
            if (evt.request.mode === 'navigate') {
              const cache = await caches.open(CACHE_NAME);
              const fallback = await cache.match('/index.html') || cache.match('/Home-page.html');
              if (fallback) return fallback;
            }
            return new Response('Offline', { status: 503, statusText: 'Offline' });
          }
        })());
      });
      self.addEventListener('message', async (evt) => {
        const data = evt.data || {};
        if (data && data.type === 'CACHE_URLS' && Array.isArray(data.urls)) {
          try {
            const cache = await caches.open(CACHE_NAME);
            await cache.addAll(data.urls);
            const cs = await self.clients.matchAll();
            cs.forEach(c => c.postMessage({ type: 'cached', urls: data.urls }));
          } catch (e) {
            const cs = await self.clients.matchAll();
            cs.forEach(c => c.postMessage({ type: 'cache_failed', error: String(e) }));
          }
        }
      });
    `;
    try {
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const blobUrl = URL.createObjectURL(blob);
      const reg = await navigator.serviceWorker.register(blobUrl);
      swRegistration = reg;
      console.info('Inline Service Worker registered.');
      await waitForServiceWorkerReady();
      return swRegistration;
    } catch (err2) {
      console.error('Inline SW registration failed:', err2);
      return null;
    }
  }
  function waitForServiceWorkerReady(timeout = 10000) {
    return new Promise((resolve) => {
      let done = false;
      navigator.serviceWorker.ready.then(reg => {
        if (!done) { done = true; swRegistration = reg; resolve(reg); }
      }).catch(() => {
        if (!done) { done = true; resolve(null); }
      });
      setTimeout(() => { if (!done) { done = true; resolve(null); } }, timeout);
    });
  }
  // ========== Caching Fallback ==========
  async function cacheResourcesFromPage(urls = PRECACHE_URLS) {
    if (!('caches' in window)) {
      console.warn('Cache API not available.');
      return false;
    }
    try {
      const cache = await caches.open(CACHE_NAME);
      const toCache = Array.from(new Set((urls || []).filter(u => typeof u === 'string')));
      await cache.addAll(toCache);
      console.info('Resources cached via Cache API:', toCache);
      return true;
    } catch (err) {
      console.warn('Cache via page failed:', err);
      return false;
    }
  }
  // ========== Install Modal ==========
  function ensureInstallModalExists() {
    if ($('pwa-install-modal')) return;
    const overlay = createEl('div', {
      id: 'pwa-install-modal',
      style: {
        position: 'fixed',
        inset: '0',
        display: 'none',
        alignItems: 'center',
        justifyContent: 'center',
        background: 'rgba(0,0,0,0.45)',
        zIndex: 2147483647
      }
    });
    const card = createEl('div', {
      id: 'pwa-install-modal-card',
      style: {
        width: '380px',
        maxWidth: '94%',
        background: '#0B0E11',
        borderRadius: '14px',
        padding: '18px',
        boxShadow: '0 10px 30px rgba(0,0,0,0.5)',
        fontFamily: 'Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial',
        color: '#EAECEF',
        border: '1px solid #2B3139'
      }
    });
    const headerRow = createEl('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '10px' } });
    const logoImg = createEl('img', {
      attrs: { id: 'exness-logo', src: ICON_PNG_URL, alt: 'Exness Logo' },
      style: { width: '44px', height: '44px', borderRadius: '8px', objectFit: 'cover', border: '1px solid rgba(255,255,255,0.06)' }
    });
    headerRow.appendChild(logoImg);
    const title = createEl('div', { innerText: 'Install Exness Auto-Trading Bot', style: { fontSize: '18px', fontWeight: 700, color: '#FFDE02' } });
    headerRow.appendChild(title);
    const desc = createEl('div', {
      innerText: 'Install the app for faster access, offline support, and a home-screen experience.',
      style: { fontSize: '13px', marginTop: '6px', color: '#9AA4B2' }
    });
    const progressContainer = createEl('div', { id: 'pwa-install-progress', style: { display: 'none', marginTop: '12px' } });
    const progressOuter = createEl('div', { style: { width: '100%', height: '10px', background: '#242933', borderRadius: '8px', overflow: 'hidden', border: '1px solid #2B3139' }});
    const progressBar = createEl('div', { id: 'pwa-install-progress-bar', style: { width: '0%', height: '100%', background: '#FFDE02', transition: 'width 300ms ease' }});
    progressOuter.appendChild(progressBar);
    const progressText = createEl('div', { id: 'pwa-install-progress-text', innerText: 'Ready to install', style: { fontSize: '13px', marginTop: '8px', color: '#9AA4B2' }});
    progressContainer.appendChild(progressOuter);
    progressContainer.appendChild(progressText);
    const actions = createEl('div', { style: { display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '14px' }});
    const cancelBtn = createEl('button', { id: 'cancel-install-btn', innerText: 'Cancel', style: {
      padding: '8px 12px', borderRadius: '10px', border: '1px solid #2B3139', background: '#242933', color: '#EAECEF', cursor: 'pointer', fontWeight: 600
    }});
    const installBtn = createEl('button', { id: 'install-now-btn', innerText: 'Get App', style: {
      padding: '8px 14px', borderRadius: '10px', border: '0', background: '#FFDE02', color: '#111', cursor: 'pointer', fontWeight: 800
    }});
    actions.appendChild(cancelBtn);
    actions.appendChild(installBtn);
    card.appendChild(headerRow);
    card.appendChild(desc);
    card.appendChild(progressContainer);
    card.appendChild(actions);
    overlay.appendChild(card);
    document.body.appendChild(overlay);
    cancelBtn.addEventListener('click', hideInstallModal);
    installBtn.addEventListener('click', onInstallNowClicked);
    overlay.addEventListener('click', (e) => { if (e.target === overlay) hideInstallModal(); });
  }
  function showInstallModal() {
    ensureInstallModalExists();
    const overlay = $('pwa-install-modal');
    if (!overlay) return;
    overlay.style.display = 'flex';
    const prog = $('pwa-install-progress'); if (prog) prog.style.display = 'none';
    const bar = $('pwa-install-progress-bar'); if (bar) bar.style.width = '0%';
    const text = $('pwa-install-progress-text'); if (text) text.innerText = 'Ready to install';
    const installBtn = $('install-now-btn'); if (installBtn) { 
      installBtn.innerText = deferredPrompt ? 'Install Now' : 'Get App'; 
      installBtn.disabled = false; 
      installBtn.style.opacity = '1'; 
    }
  }
  function hideInstallModal() {
    const overlay = $('pwa-install-modal');
    if (!overlay) return;
    overlay.style.display = 'none';
  }
  async function onInstallNowClicked(e) {
    if (e) e.preventDefault();
    const installBtn = $('install-now-btn');
    const cancelBtn = $('cancel-install-btn');
    const progress = $('pwa-install-progress');
    const progressBar = $('pwa-install-progress-bar');
    const progressText = $('pwa-install-progress-text');
    if (installBtn) { installBtn.disabled = true; installBtn.style.opacity = '0.8'; installBtn.innerText = 'Starting...'; }
    if (cancelBtn) cancelBtn.disabled = true;
    // If native prompt is available
    if (deferredPrompt) {
      try {
        deferredPrompt.prompt();
        const choice = await deferredPrompt.userChoice;
        deferredPrompt = null;
        if (choice.outcome === 'accepted') {
          if (progress) progress.style.display = 'block';
          if (progressBar) progressBar.style.width = '60%';
          if (progressText) progressText.innerText = 'Finalizing native install...';
          await waitForAppInstalledOrTimeout(12000);
          await ensureSWAndCacheWithProgress(progressBar, progressText);
          finalizeInstallUI(true);
          return;
        } else {
          if (progress) progress.style.display = 'block';
          if (progressBar) progressBar.style.width = '20%';
          if (progressText) progressText.innerText = 'Falling back to offline install...';
          await fallbackInstallSequence(progressBar, progressText);
          finalizeInstallUI(true, 'installed (fallback)');
          return;
        }
      } catch (err) {
        console.warn('Prompt error', err);
        await fallbackInstallSequence(progressBar, progressText);
        finalizeInstallUI(true, 'installed (fallback)');
        return;
      }
    }
    // Fallback flow
    if (progress) progress.style.display = 'block';
    if (progressBar) progressBar.style.width = '10%';
    if (progressText) progressText.innerText = 'Registering service worker...';
    await fallbackInstallSequence(progressBar, progressText);
    finalizeInstallUI(true, 'installed (fallback)');
  }
  function finalizeInstallUI(success = true, extraText = '') {
    const installBtn = $('install-now-btn');
    const cancelBtn = $('cancel-install-btn');
    const progressText = $('pwa-install-progress-text');
    if (installBtn) {
      installBtn.innerText = success ? 'App installed' : 'Install';
      installBtn.disabled = true;
      installBtn.style.background = success ? '#16A34A' : '';
    }
    if (cancelBtn) cancelBtn.disabled = false;
    if (progressText) progressText.innerText = success ? `App installed${extraText ? ' — ' + extraText : ''}` : 'Installation failed';
    isAppInstalled = !!success;
    // Show toast
    try {
      const toast = createEl('div', { innerText: success ? 'Exness Bot installed' : 'Install failed', style: {
        position: 'fixed', right: '16px', bottom: '16px', background: '#111827', color: '#fff', padding: '10px 14px', borderRadius: '10px', zIndex: 2147483648, boxShadow: '0 6px 20px rgba(0,0,0,0.4)'
      }});
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3500);
    } catch (e) {}
    setTimeout(hideInstallModal, 1400);
  }
  async function fallbackInstallSequence(progressBar, progressText) {
    try {
      if (progressText) progressText.innerText = 'Registering service worker...';
      const reg = await registerServiceWorker();
      if (reg && reg.active) {
        if (progressBar) progressBar.style.width = '35%';
        if (progressText) progressText.innerText = 'Preparing app files...';
        try { reg.active.postMessage({ type: 'CACHE_URLS', urls: PRECACHE_URLS }); } catch {}
        await cacheResourcesFromPage(PRECACHE_URLS);
        if (progressBar) progressBar.style.width = '90%';
        if (progressText) progressText.innerText = 'Finalizing...';
        await new Promise(r => setTimeout(r, 700));
        maybeShowIOSInstructions();
      } else {
        if (progressBar) progressBar.style.width = '45%';
        if (progressText) progressText.innerText = 'Caching app resources...';
        await cacheResourcesFromPage(PRECACHE_URLS);
        if (progressBar) progressBar.style.width = '95%';
        if (progressText) progressText.innerText = 'Finalizing...';
        await new Promise(r => setTimeout(r, 600));
        maybeShowIOSInstructions();
      }
    } catch (err) {
      console.error('fallbackInstallSequence error:', err);
      if (progressText) progressText.innerText = 'Installation issues — offline may be limited.';
    }
  }
  function maybeShowIOSInstructions() {
    const ua = navigator.userAgent || '';
    if (/iphone|ipad|ipod/i.test(ua) && !window.matchMedia('(display-mode: standalone)').matches) {
      const t = $('pwa-install-progress-text');
      if (t) t.innerText = 'Tap the Share button → Add to Home Screen to install on iOS';
    }
  }
  async function ensureSWAndCacheWithProgress(progressBar, progressText) {
    try {
      if (progressText) progressText.innerText = 'Ensuring service worker...';
      const reg = swRegistration || await registerServiceWorker();
      if (reg && reg.active) {
        if (progressBar) progressBar.style.width = '50%';
        if (progressText) progressText.innerText = 'Caching app files...';
        reg.active.postMessage({ type: 'CACHE_URLS', urls: PRECACHE_URLS });
        await cacheResourcesFromPage(PRECACHE_URLS);
        if (progressBar) progressBar.style.width = '100%';
        if (progressText) progressText.innerText = 'App files cached';
        return true;
      } else {
        await cacheResourcesFromPage(PRECACHE_URLS);
        if (progressBar) progressBar.style.width = '100%';
        if (progressText) progressText.innerText = 'App files cached (no SW)';
        return true;
      }
    } catch (e) {
      console.warn('ensureSWAndCache error', e);
      return false;
    }
  }
  function waitForAppInstalledOrTimeout(timeoutMs = 15000) {
    return new Promise((resolve) => {
      if (isAppInstalled) return resolve();
      let done = false;
      function onInstalled() {
        if (done) return;
        done = true;
        window.removeEventListener('appinstalled', onInstalled);
        resolve();
      }
      window.addEventListener('appinstalled', onInstalled);
      setTimeout(() => {
        if (done) return;
        done = true;
        window.removeEventListener('appinstalled', onInstalled);
        resolve();
      }, timeoutMs);
    });
  }
  function setupSWMessageHandler() {
    if (!('serviceWorker' in navigator)) return;
    navigator.serviceWorker.addEventListener('message', (evt) => {
      const data = evt.data || {};
      const progressBar = $('pwa-install-progress-bar');
      const progressText = $('pwa-install-progress-text');
      if (data && data.type) {
        if (data.type === 'precached' || data.type === 'cached') {
          if (progressBar) progressBar.style.width = '100%';
          if (progressText) progressText.innerText = 'App files cached';
          setTimeout(() => finalizeInstallUI(true), 700);
        } else if (data.type === 'cache_failed') {
          if (progressText) progressText.innerText = 'Caching failed — offline limited';
          finalizeInstallUI(true, 'partial');
        }
      }
    });
  }
  function setupGetAppButtons() {
    const handler = (e) => { if (e) e.preventDefault && e.preventDefault(); showInstallModal(); };
    const ids = ['get-app-btn', 'get-mobile-app', 'getApp', 'getMobileApp', 'install-pwa', 'getAppButton', 'get-app'];
    ids.forEach(id => {
      const el = $(id) || document.querySelector(`#${id}`);
      if (el) {
        try { el.removeEventListener('click', handler); } catch (e) {}
        el.addEventListener('click', handler);
      }
    });
    const nodes = document.querySelectorAll('[data-install-pwa]');
    nodes.forEach(n => { n.removeEventListener('click', handler); n.addEventListener('click', handler); });
    window.openStoreOrPrompt = function () {
      const ua = navigator.userAgent.toLowerCase();
      if (ua.includes('android')) {
        window.open('https://play.google.com/store/apps', '_blank');
      } else if (/(iphone|ipad|ipod)/i.test(navigator.userAgent)) {
        window.open('https://apps.apple.com/', '_blank');
      } else {
        showInstallModal();
      }
    };
  }
  // ========== Button Actions ==========
  async function delayRedirect(buttonId, text) {
    const btn = $(buttonId);
    if (!btn) return;
    const origText = btn.innerText;
    btn.innerText = text; 
    btn.disabled = true;
    await new Promise(r => setTimeout(r, 15000)); 
    window.location.href = 'AI-Trading-Bot.html';
    btn.innerText = origText; 
  }
  function attachButtonActions() {
    // Quick action buttons
    $('connect-portfolio-btn')?.addEventListener('click', () => delayRedirect('connect-portfolio-btn', 'Connecting...'));
    $('login-id-btn')?.addEventListener('click', () => delayRedirect('login-id-btn', 'Loading...'));
    $('start-free-trial-btn')?.addEventListener('click', () => delayRedirect('start-free-trial-btn', 'Preparing...'));
    $('support-btn')?.addEventListener('click', () => delayRedirect('support-btn', 'Loading...'));
    // Mobile dropdown buttons
    $('connect-portfolio-btn-mobile')?.addEventListener('click', () => delayRedirect('connect-portfolio-btn-mobile', 'Connecting...'));
    $('login-id-btn-mobile')?.addEventListener('click', () => delayRedirect('login-id-btn-mobile', 'Loading...'));
    $('start-free-trial-btn-mobile')?.addEventListener('click', () => delayRedirect('start-free-trial-btn-mobile', 'Preparing...'));
    $('support-btn-mobile')?.addEventListener('click', () => delayRedirect('support-btn-mobile', 'Loading...'));
    // "More" menu toggle
    const moreBtn = $('more-options-btn');
    const moreMenu = $('more-options-menu');
    moreBtn?.addEventListener('click', () => {
      if (moreMenu) moreMenu.style.display = moreMenu.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', (e) => {
      if (moreMenu && !moreBtn.contains(e.target) && !moreMenu.contains(e.target)) {
        moreMenu.style.display = 'none';
      }
    });
  }
  // ========== Market Data Fetching ==========
  async function fetchMarketData() {
    try {
      const data = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin&vs_currencies=usd&include_24hr_vol=true&include_24hr_change=true').then(res => res.json());
      if (data.bitcoin) {
        $('btc-price').textContent = `$${Number(data.bitcoin.usd).toLocaleString()}`;
        $('btc-volume').textContent = `$${((data.bitcoin.usd_24h_vol||0)/1e6).toFixed(1)}M`;
      }
      if (data.ethereum) {
        $('eth-price').textContent = `$${Number(data.ethereum.usd).toLocaleString()}`;
        $('eth-volume').textContent = `$${((data.ethereum.usd_24h_vol||0)/1e6).toFixed(1)}M`;
      }
      if (data.binancecoin) {
        $('bnb-price').textContent = `$${Number(data.binancecoin.usd).toFixed(2)}`;
        $('bnb-volume').textContent = `$${((data.binancecoin.usd_24h_vol||0)/1e6).toFixed(1)}M`;
      }
    } catch (error) {
      console.error('Failed to fetch market data:', error);
    }
  }
  async function fetchTopCoins() {
    try {
      const coins = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=3&page=1').then(res => res.json());
      const container = $('top-coins');
      if (!container) return;
      container.innerHTML = ''; // clear placeholders
      coins.forEach(coin => {
        const card = createEl('div', { className: 'trading-card rounded-2xl p-6 hover-glow' });
        const name = createEl('h4', { innerText: coin.name, style: { fontSize: '18px', marginBottom: '6px', color: '#FFF' } });
        const price = createEl('p', { innerText: `$${coin.current_price.toLocaleString()}`, style: { fontSize: '24px', fontWeight: 'bold' } });
        const change = createEl('p', { innerText: `${coin.price_change_percentage_24h.toFixed(2)}%`, className: coin.price_change_percentage_24h >= 0 ? 'price-up' : 'price-down' });
        card.appendChild(name);
        card.appendChild(price);
        card.appendChild(change);
        container.appendChild(card);
      });
    } catch (e) {
      console.error('Failed to fetch top coins:', e);
    }
  }
  async function fetchGlobalData() {
    try {
      const globalData = await fetch('https://api.coingecko.com/api/v3/global').then(res => res.json());
      if (globalData.data) {
        $('total-market-cap').textContent = `$${Number(globalData.data.total_market_cap.usd.toFixed(0)).toLocaleString()}`;
        $('active-cryptos').textContent = Number(globalData.data.active_cryptocurrencies).toLocaleString();
        $('market-count').textContent = Number(globalData.data.markets).toLocaleString();
      }
    } catch (e) {
      console.error('Failed to fetch global data:', e);
    }
  }
  // ========== Initialization ==========
  function initOnDomReady() {
    ensureManifest();
    ensureInstallModalExists();
    registerServiceWorker().then(reg => { if (reg) { swRegistration = reg; setupSWMessageHandler(); } }).catch(err => console.warn(err));
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      console.info('beforeinstallprompt captured.');
      const banner = $('pwa-install-banner');
      if (banner) banner.style.display = 'flex';
    });
    window.addEventListener('appinstalled', (evt) => {
      console.info('PWA installed:', evt);
      isAppInstalled = true;
      finalizeInstallUI(true);
    });
    setupGetAppButtons();
    attachButtonActions();
    // Market data
    fetchGlobalData();
    fetchTopCoins();
    fetchMarketData();
    setInterval(fetchMarketData, 30000);
    setInterval(fetchTopCoins, 60000);
    // Show install modal on load (like Binance example)
    showInstallModal();
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initOnDomReady);
  } else {
    initOnDomReady();
  }
  // ========== Public PWA Installer ========
  window.pwaInstaller = {
    showInstallModal,
    hideInstallModal,
    ensureManifest,
    registerServiceWorker,
    cacheResourcesFromPage,
    isAppInstalled: () => isAppInstalled
  };
})();
    </script>
</body>
</html>
